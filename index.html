<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=0.7" />
  <title>NXew - Premium Clothing & Accessories</title>
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet" />
  <!-- QR Code Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <!-- html2canvas Library for Download Functionality -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <!-- EmailJS -->
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script> 
  <style>
    /* Base theme */
    :root {
      --primary-color: #2a5298;
      --secondary-color: #ffdd57;
      --accent-color: #e1306c;
      --dark-color: #343a40;
      --light-color: #f8f9fa;
      --success-color: #28a745;
      --danger-color: #dc3545;
      --warning-color: #ffc107;
      --info-color: #17a2b8;
    }
    
    * {
      scroll-behavior: smooth;
    }
    
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f6f9fc, #e9f0f8), url('https://www.toptal.com/designers/subtlepatterns/uploads/double-bubble-outline.png');
      background-size: cover;
      padding-bottom: 70px;
      padding-top: 60px;
    }
    
    /* Header Styles */
    header {
      background: white;
      color: black;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); /* More pronounced shadow from additional CSS */
      transition: all 0.3s ease;
    }
    
    .scrolled-header {
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      padding: 5px 0;
    }
    
    header h1, header .profile-name { color: black; }
    
    /* Button Styles */
    .btn-primary { 
      background-color: var(--primary-color); 
      border-color: var(--primary-color); 
    }
    .btn-primary:hover {
      background-color: #1a3a6b; /* Darker shade from additional CSS */
      border-color: #1a3a6b;
    }
    
    .btn-secondary {
      background-color: var(--dark-color);
      border-color: var(--dark-color);
    }
    
    .btn-danger { 
      background-color: var(--danger-color); 
      border-color: var(--danger-color); 
    }
    
    .btn-info { 
      background-color: var(--info-color); 
      border-color: var(--info-color); 
    }
    
    .btn-warning {
      background-color: var(--warning-color);
      border-color: var(--warning-color);
      color: var(--dark-color);
    }
    
    .bg-light { background-color: var(--light-color) !important; }
    
    /* Animation Styles */
    .fade-in { 
      animation: fadeIn 0.5s ease-in-out; 
    }
    
    @keyframes fadeIn { 
      from { opacity: 0; } 
      to { opacity: 1; } 
    }
    
    .slide-up {
      animation: slideUp 0.5s ease-out;
    }
    
    @keyframes slideUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    /* General Styling */
    .hero { 
      padding: 20px 0; 
      background: rgba(255,255,255,0.9);
      border-radius: 10px;
      margin: 20px 0;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .hero h2 { 
      font-size: 1.75rem; 
      margin-bottom: 0.5rem; 
      color: var(--primary-color);
    }
    
    .product-highlight img, .category-item img { 
      border-radius: 5px; 
      transition: transform 0.3s ease;
    }
    
    .product-highlight img:hover, .category-item img:hover {
      transform: scale(1.02);
    }
    
    header h1 { 
      font-size: 1.125rem; 
      font-weight: 600; 
    }
    
    header .profile-name { 
      font-size: 1rem; 
      margin-left: 10px; 
    }
    
    /* Header Navigation */
    nav a, nav button { 
      font-size: 0.9rem; 
      padding: 5px 1px; 
      color: black; 
      text-decoration: none; 
      background: none; 
      border: none; 
    }
    
    nav a:hover, nav button:hover { 
      color: #333; 
    }
    
    nav .btn i { 
      font-size: 1.75rem; 
      transition: color 0.3s ease; 
    }
    
    nav .btn i:hover { 
      color: var(--secondary-color); 
    }
    
    .header-nav { 
      display: flex; 
      gap: 0.5rem; 
      align-items: center; 
    }
    
    #notificationButton { 
      font-size: 1.75rem; 
      position: relative;
    }
    
    .notification-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background-color: var(--danger-color);
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      font-weight: bold;
    }
    
    /* Improved Icon Appearance */
    button[data-bs-target="#menuCanvas"] i {
      font-size: 2rem;
      color: var(--primary-color);
    }
    
    .btn {
      border-width: 1px;
      transition: all 0.3s ease;
    }
    
    nav .btn i {
      font-size: 1.75rem;
      color: var(--primary-color);
    }
    
    nav .btn i:hover {
      color: var(--secondary-color);
    }
    
    /* Updated Category Section Styling */
    .categories {
      padding: 50px 0;
      background-color: var(--light-color);
    }
    
    .category-item {
      position: relative;
      cursor: pointer;
      overflow: hidden;
      border-radius: 10px;
      transition: transform 0.3s ease;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .category-item:hover {
      transform: scale(1.02);
    }
    
    .category-item img {
      width: 100%;
      height: 300px;
      object-fit: cover;
      border-radius: 10px;
    }
    
    .category-label {
      position: absolute;
      bottom: 0;
      right: 0;
      padding: 10px 20px;
      color: white;
      font-size: 1.5rem;
      font-weight: bold;
      text-align: right;
    }
    
    /* Section Visibility */
    .section { 
      display: none; 
      min-height: calc(100vh - 120px);
      background: var(--light-color); /* From additional CSS */
      padding: 20px; /* From additional CSS */
      border-radius: 10px; /* From additional CSS */
      margin-bottom: 20px; /* From additional CSS */
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05); /* Subtle shadow from additional CSS */
    }
    
    .active-section { 
      display: block; 
      animation: fadeIn 0.5s ease-in-out;
    }
    
    /* Offcanvas Menu */
    .offcanvas { 
      background: var(--light-color); 
      border-right: 4px solid var(--primary-color); 
      width: 300px !important;
    }
    
    .offcanvas-header { 
      background: var(--primary-color); 
      color: #fff; 
    }
    
    .offcanvas-header .btn-close { 
      filter: invert(1); 
    }
    
    .custom-menu-item { 
      padding: 12px 15px; 
      font-size: 1rem; 
      border-bottom: 1px solid #ddd; 
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
    }
    
    .custom-menu-item:hover { 
      background: #e9f0fa; 
      padding-left: 20px;
    }
    
    .custom-menu-item i {
      margin-right: 10px;
      width: 20px;
      text-align: center;
    }
    
    #menuAccountDetails { 
      padding: 15px; 
      background: #fff; 
      border-bottom: 2px solid var(--primary-color); 
      border-radius: 5px; 
      text-align: center; 
      margin-bottom: 10px; 
    }
    
    /* Popup Modal */
    .popup-modal-content { 
      border: 3px solid var(--primary-color); 
      border-radius: 12px; 
      background: linear-gradient(135deg, #fff, #f0f8ff); 
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.15); 
    }
    
    .popup-modal-header, .popup-modal-footer { 
      border: none; 
    }
    
    .popup-modal-body { 
      text-align: center; 
      font-size: 1.3rem; 
      font-weight: 600; 
      padding: 20px; 
    }
    
    /* Toast Container */
    #toastContainer { 
      position: fixed; 
      top: 1rem; 
      right: 1rem; 
      z-index: 1100; 
    }
    
    /* Product Detail Styling */
    .product-detail-img { 
      max-height: 600px; 
      object-fit: contain; 
      margin-bottom: 20px; 
      border-radius: 0px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      cursor: zoom-in;
      transition: all 0.3s ease;
    }
    .product-detail-img:hover {
      transform: scale(1.1);
      transition: transform 0.3s ease;
    }
    
    /* Updated Footer Styles */
    .footer-nav {
      background: white; /* From additional CSS */
      border-top: 2px solid #e9ecef;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 1200;
      padding: 5px 0;
      box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1); /* Top shadow from additional CSS */
      height: 70px;
    }
    
    .footer-nav .nav-list {
      display: flex;
      justify-content: space-around;
      align-items: center;
      width: 100%;
      margin: 0;
      padding: 0;
      list-style: none;
      height: 100%;
    }
    
    .footer-nav .nav-item {
      flex: 1;
      text-align: center;
      position: relative;
      transition: transform 0.2s ease;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .footer-nav .nav-link {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      padding: 5px;
      height: 100%;
      width: 100%;
      transition: all 0.3s ease;
      position: relative;
    }
    
    .footer-nav .nav-link i {
      font-size: 1.8rem;
      color: var(--primary-color);
      transition: all 0.3s ease;
      margin-bottom: 3px;
    }
    
    .footer-nav .nav-text {
      font-size: 0.75rem;
      color: var(--dark-color);
      transition: color 0.2s ease;
      text-transform: uppercase;
      font-weight: 500;
    }
    
    .footer-nav .nav-link:hover i,
    .footer-nav .nav-link.active i {
      color: var(--secondary-color);
      transform: scale(1.1);
    }
    
    .footer-nav .nav-link:hover .nav-text,
    .footer-nav .nav-link.active .nav-text {
      color: var(--secondary-color); /* Hover color from additional CSS */
    }
    
    .footer-nav .nav-link.active::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 50%;
      height: 3px;
      background-color: var(--secondary-color);
      border-radius: 3px 3px 0 0;
    }
    
    .footer-nav .nav-link.active {
      color: var(--primary-color); /* Active state from additional CSS */
      font-weight: bold; /* From additional CSS */
    }
    
    .footer-nav .badge {
      position: absolute;
      top: 5px;
      right: 25%;
      background-color: var(--secondary-color);
      color: black;
      font-size: 0.7rem;
      padding: 2px 5px;
      border-radius: 50%;
      font-weight: bold;
      transform: translateX(50%);
    }
    
    @media (max-width: 768px) {
      .footer-nav {
        height: 65px;
      }
      .footer-nav .nav-link i {
        font-size: 1.6rem;
      }
      .footer-nav .nav-text {
        font-size: 0.7rem;
      }
      .footer-nav .badge {
        top: 3px;
        right: 35%;
        font-size: 0.6rem;
        padding: 1px 4px;
      }
      .category-item img {
        height: 150px; /* Decreased height for smaller screens */
      }
      .category-label {
        font-size: 1.2rem;
        padding: 8px 15px;
      }
    }
    
    /* Enhanced Button Hover Effects */
    .btn:hover { 
      transform: translateY(-2px) scale(1.05); 
      box-shadow: 0 5px 10px rgba(0,0,0,0.1);
    }
    
    /* Enhanced Cancel Icon in Popup */
    .btn-close:hover {
      transform: scale(1.2);
      transition: transform 0.2s ease;
    }
    
    .card:hover { 
      box-shadow: 0 10px 20px rgba(0,0,0,0.1); 
      transform: translateY(-5px);
    }
    
    .card {
      transition: all 0.3s ease;
      border: none;
      overflow: hidden;
    }
    
    /* Track Bar Styling */
    .track-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 20px 0;
    }
    
    .track-step {
      text-align: center;
      position: relative;
      flex: 1;
    }
    
    .track-step:not(:last-child):after {
      content: '';
      position: absolute;
      top: 15px;
      left: 50%;
      width: 100%;
      height: 2px;
      background-color: #ccc;
      z-index: -1;
    }
    
    .track-bar.received .track-step:not(:last-child):after { background-color: var(--success-color); }
    .track-bar.cancelled .track-step:not(:last-child):after { background-color: var(--danger-color); }
    
    .track-step span {
      display: block;
      width: 30px;
      height: 30px;
      line-height: 30px;
      border-radius: 50%;
      background-color: #ccc; /* Inactive step color from additional CSS */
      color: #fff;
      margin: 0 auto 5px;
    }
    
    .track-step.active span { 
      background-color: var(--success-color); /* Active step color from additional CSS */
    }
    .track-step.cancelled span { 
      background-color: var(--danger-color); 
    }
    
    :read-only:focus {
      outline: none;
      border-color: #ced4da;
    }
    
    .color-thumbnail { 
      display: inline-block; 
      margin: 5px; 
      border: 2px solid transparent; 
      cursor: pointer; 
      border-radius: 50%;
      overflow: hidden;
      width: 40px;
      height: 40px;
      transition: all 0.3s ease;
    }
    
    .color-thumbnail img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .color-thumbnail.selected { 
      border-color: #000; 
      transform: scale(1.1);
    }
    
    /* Product Images Modal Styling */
    #productImagesModal .modal-body { 
      overflow: auto; 
      max-height: 80vh; 
      text-align: center; 
      padding: 0;
    }
    
    #productCarousel img { 
      max-height: 500px; 
      object-fit: contain; 
    }
    
    .carousel-control-prev, .carousel-control-next {
      background-color: rgba(0,0,0,0.2);
      width: 40px;
      height: 40px;
      border-radius: 50%;
      top: 50%;
      transform: translateY(-50%);
      opacity: 0.8;
    }
    
    .carousel-control-prev:hover, .carousel-control-next:hover {
      background-color: rgba(0,0,0,0.4);
    }
    
    .carousel-control-prev {
      left: 15px;
    }
    
    .carousel-control-next {
      right: 15px;
    }
    
    /* Product Card Styling */
    .product-card {
      transition: all 0.3s ease; /* From additional CSS */
      height: 100%;
      display: flex;
      flex-direction: column;
      background: white;
    }
    
    .product-card:hover {
      transform: translateY(-5px); /* Slight lift from additional CSS */
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1); /* Stronger shadow from additional CSS */
    }
    
    .product-card .card-body {
      flex-grow: 1;
      padding: 15px;
    }
    
    .product-card .card-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--primary-color);
    }
    
    .product-card .card-text {
      font-size: 0.9rem;
    }
    
    .product-card img {
      transition: transform 0.3s ease; /* From additional CSS */
    }
    
    .product-card:hover img {
      transform: scale(1.05); /* Subtle zoom effect from additional CSS */
    }
    
    /* Recommendations Section */
    .recommendations-section {
      margin-top: 40px;
      padding-top: 20px;
      border-top: 1px solid #eee;
    }
    
    .recommendations-title {
      font-size: 1.5rem;
      margin-bottom: 20px;
      text-align: center;
      color: #2a5298;
    }
    
    .recommendation-card {
      cursor: pointer;
      transition: all 0.3s ease;
      margin-bottom: 20px;
    }
    
    .recommendation-card:hover {
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      transform: translateY(-5px);
    }
    
    .recommendation-img {
      height: 200px;
      object-fit: cover;
      border-radius: 5px;
    }
    
    .recommendation-badge {
      position: absolute;
      top: 10px;
      right: 10px;
      background-color: #ffdd57;
      color: #000;
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 0.8rem;
    }
    
    /* Enhanced Search Section */
    .search-container {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: space-between;
      max-width: 800px;
      margin: 0 auto;
      padding: 10px;
      background: white;
      border-radius: 25px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    #searchBarContainer {
      flex-grow: 1;
      margin-left: 10px;
      margin-right: 20px;
    }
    
    .search-container input {
      border: none;
      outline: none;
      flex-grow: 1;
      padding: 5px;
      font-size: 0.9rem;
    }
    
    .search-container input:focus {
      box-shadow: 0 0 0 2px var(--primary-color); /* Focus ring from additional CSS */
    }
    
    /* Voice Search Button Active State */
    .search-container .btn-outline-secondary.active {
      background-color: var(--danger-color);
      color: white;
      border-color: var(--danger-color);
    }
    
    .search-suggestions {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: white;
      border: 1px solid #ddd;
      border-top: none;
      border-radius: 0 0 15px 15px;
      z-index: 1000;
      max-height: 300px;
      overflow-y: auto;
      display: none;
      box-shadow: 0 5px 15px rgba(，令0,0,0,0.1);
    }
    
    .search-suggestion-item {
      padding: 12px 15px;
      cursor: pointer;
      border-bottom: 1px solid #eee;
      transition: background-color 0.2s;
      display: flex;
      align-items: center;
    }
    
    .search-suggestion-item:hover {
      background-color: #f8f9fa;
    }
    
    .search-suggestion-item img {
      width: 40px;
      height: 40px;
      object-fit: cover;
      margin-right: 10px;
      border-radius: 5px;
    }
    
    .search-history {
      margin-top: 15px;
      padding: 10px;
    }
    
    .search-history-item {
      display: inline-block;
      margin-right: 8px;
      margin-bottom: 8px;
      padding: 5px 10px;
      background: #f1f1f1;
      border-radius: 20px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.2s;
    }
    
    .search-history-item:hover {
      background: #e9ecef;
    }
    
    /* Draggable Filter Button */
    .draggable-filter {
      position: fixed;
      bottom: 140px;
      right: 20px;
      width: 50px;
      height: 50px;
      cursor: move;
      z-index: 1001;
      background-color: var(--primary-color);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }
    
    .draggable-filter:hover {
      background-color: #1a3a6b;
    }
    
    /* Enhanced Orders Section */
    .order-card {
      transition: all 0.3s ease;
      margin-bottom: 20px;
      cursor: pointer;
    }
    
    .order-card:hover {
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      transform: translateY(-3px);
    }
    
    .order-status-badge {
      font-size: 0.8rem;
      padding: 5px 10px;
      border-radius: 20px;
    }
    
    .order-status-confirmed {
      background-color: var(--info-color); /* From additional CSS */
      color: white; /* From additional CSS */
    }
    
    .order-status-shipped {
      background-color: var(--primary-color); /* From additional CSS */
      color: white; /* From additional CSS */
    }
    
    .order-status-delivered {
      background-color: var(--success-color); /* From additional CSS */
      color: white; /* From additional CSS */
    }
    
    .order-status-cancelled {
      background-color: var(--danger-color); /* From additional CSS */
      color: white; /* From additional CSS */
    }
    
    .order-actions {
      margin-top: 15px;
    }
    
    .order-detail-section {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 15px;
    }
    
    .order-timeline {
      position: relative;
      padding-left: 30px;
      margin-top: 20px;
    }
    
    .order-timeline::before {
      content: '';
      position: absolute;
      left: 10px;
      top: 0;
      bottom: 0;
      width: 2px;
      background: #dee2e6;
    }
    
    .timeline-item {
      position: relative;
      padding-bottom: 20px;
    }
    
    .timeline-item:last-child {
      padding-bottom: 0;
    }
    
    .timeline-item::before {
      content: '';
      position: absolute;
      left: -30px;
      top: 0;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #6c757d;
      border: 3px solid #fff;
    }
    
    .timeline-item.active::before {
      background: var(--success-color);
    }
    
    .timeline-date {
      font-size: 0.8rem;
      color: #6c757d;
    }
    
    /* Rating Stars */
    .rating-stars {
      unicode-bidi: bidi-override;
      direction: rtl;
      font-size: 1.5rem;
    }
    
    .rating-stars > span {
      display: inline-block;
      position: relative;
      width: 1.1em;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .rating-stars > span:hover:before,
    .rating-stars > span:hover ~ span:before {
      content: "★";
      position: absolute;
      color: gold; /* Interactive gold stars from additional CSS */
    }
    
    /* Filter Chips */
    .filter-chip {
      display: inline-block;
      padding: 5px 10px; /* From additional CSS */
      margin-right: 8px;
      margin-bottom: 8px;
      background: var(--primary-color); /* Primary color badge from additional CSS */
      border-radius: 20px; /* From additional CSS */
      font-size: 0.8rem; /* From additional CSS */
      color: white; /* From additional CSS */
    }
    
    .filter-chip .remove-filter {
      margin-left: 5px;
      cursor: pointer;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
      .order-card .card-body > div {
        margin-bottom: 15px;
      }
    }
    
    .order-card-image {
      height: 100px;
      width: 100px;
      object-fit: cover;
      border-radius: 5px;
      margin-right: 15px;
    }
    
    .delete-order-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      color: var(--danger-color);
      cursor: pointer;
      transition: transform 0.2s;
      background: rgba(255,255,255,0.8);
      border-radius: 50%;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .delete-order-btn:hover {
      transform: scale(1.2);
      background: rgba(255,255,255,1);
    }
    
    .cancelled-order {
      opacity: 0.8;
      background-color: #ffe6e6;
      border-left: 4px solid var(--danger-color);
    }
    
    /* Size Selection Buttons */
    .size-btn {
      margin: 3px;
      min-width: 40px;
      transition: all 0.2s;
    }
    
    .size-btn.active {
      background-color: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }
    
    /* Color Selection */
    .color-selection {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 10px 0;
    }
    
    /* Quantity Selector */
    .quantity-selector {
      display: flex;
      align-items: center;
      margin: 15px 0;
    }
    
    .quantity-btn {
      width: 30px;
      height: 30px;
      border: 1px solid #ddd;
      background: #f8f9fa;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      user-select: none;
    }
    
    .quantity-input {
      width: 50px;
      text-align: center;
      height: 30px;
      border: 1px solid #ddd;
      border-left: none;
      border-right: none;
    }
    
    /* Loading Spinner */
    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Print Styles */
    @media print {
      body * {
        visibility: hidden;
      }
      .print-selected, .print-selected * {
        visibility: visible;
        position: static; /* From additional CSS */
        width: auto; /* From additional CSS */
        height: auto; /* From additional CSS */
        margin: 0; /* From additional CSS */
        box-shadow: none; /* Clean print output from additional CSS */
      }
      .print-selected {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
      }
    }
    
    .print-mode .order-card {
      box-shadow: none;
      border: none;
    }
    
    /* Dark Mode Toggle */
    .dark-mode-toggle {
      position: fixed;
      bottom: 140px;
      right: 20px;
      width: 50px;
      height: 50px;
      background-color: var(--dark-color);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 1000;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }
    
    /* Mobile Menu Toggle Animation */
    .navbar-toggler {
      transition: all 0.3s ease;
    }
    
    .navbar-toggler:focus {
      box-shadow: none;
    }
    
    .navbar-toggler.collapsed .navbar-toggler-icon {
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba%280, 0, 0, 0.55%29' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e");
    }
    
    /* Product Badges */
    .product-badge {
      position: absolute;
      top: 10px;
      left: 10px;
      padding: 5px 10px;
      border-radius: 3px;
      font-size: 0.8rem;
      font-weight: bold;
      color: white;
    }
    
    .badge-new {
      background-color: var(--success-color);
    }
    
    .badge-sale {
      background-color: var(--danger-color);
    }
    
    .badge-featured {
      background-color: var(--accent-color);
    }
    
    /* Mobile Optimization */
    @media (max-width: 768px) {
      body {
        padding-bottom: 60px;
      }
      .hero h2 {
        font-size: 1.5rem;
      }
      header h1 {
        font-size: 1rem;
        max-width: 120px;
      }
    }
    
    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
    }
    
    ::-webkit-scrollbar-track {
      background: var(--bg-color);
    }
    
    ::-webkit-scrollbar-thumb {
      background: var(--primary-color);
      border-radius: 3px;
    }
    
    /* Enhanced Toast Styling */
    #toastContainer {
      position: fixed;
      top: 1rem;
      right: 1rem;
      z-index: 1100;
      min-width: 300px;
      max-width: 400px;
    }
    
    .toast {
      margin-bottom: 0.5rem;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      opacity: 0;
      transform: translateY(-20px);
      transition: opacity 0.3s ease, transform 0.3s ease;
    }
    
    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }
    
    .toast-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.5rem 1rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .toast-header .toast-title {
      margin: 0;
      font-size: 1rem;
      font-weight: 600;
    }
    
    .toast-body {
      padding: 1rem;
      font-size: 0.95rem;
    }
    
    .toast .notification-icon {
      margin-right: 0.5rem;
      font-size: 1.2rem;
    }
    
    /* Type-specific colors */
    .bg-success { background-color: var(--success-color) !important; }
    .bg-danger { background-color: var(--danger-color) !important; }
    .bg-warning { background-color: var(--warning-color) !important; }
    .bg-info { background-color: var(--info-color) !important; }
    
    /* Custom styles for Shop Now button in carousel */
    .carousel-caption {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 20px;
      background: rgba(0, 0, 0, 0.5);
      color: white;
      text-align: center;
    }
    
    .carousel-caption .btn {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      width: 150px;
    }
    
    /* Enhanced Search Bar Styling for Shop Section */
    .search-bar {
      position: relative;
    }
    .search-bar input {
      padding-left: 50px;
      border-radius: 50px;
      border: 1px solid #ccc;
      background-color: #f8f9fa;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .search-bar .search-icon {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: #666;
      font-size: 1.2rem;
    }
    .search-bar input:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 0.2rem rgba(42, 82, 152, 0.25);
    }
    
    /* Website Branding in Order Cards */
    .website-branding {
      display: flex;
      align-items: center;
    }
    
    .website-branding img {
      width: 30px;
      height: 30px;
      margin-right: 10px;
    }
    
    .website-branding span {
      font-weight: bold;
      font-size: 1.2rem;
      color: var(--primary-color);
    }
    
    /* Make carousel items clickable */
    .carousel-item {
      cursor: pointer;
    }
    
    /* Full-screen carousel styles */
    .full-screen-wrapper {
      position: relative;
      height: 60vh; /* Decreased height */
      width: 100%;
    }
    
    .full-screen-carousel {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
    
    .full-screen-carousel .carousel-inner,
    .full-screen-carousel .carousel-item {
      height: 100%;
    }
    
    .full-screen-carousel .carousel-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .footer-main {
      background-color: #f8f9fa;
      padding: 30px 0 0;
      border-top: 1px solid #e9ecef;
    }
    
    /* Fix the main footer only when home section is active */
    body.home-section-active .footer-main {
      position: fixed;
      bottom: 70px; /* Position above footer-nav, which is 70px high */
      left: 0;
      right: 0;
      z-index: 999; /* Below footer-nav (z-index: 1200) */
    }
    
    .footer-links h5 {
      color: var(--primary-color);
      font-size: 1.1rem;
      margin-bottom: 1rem;
      font-weight: 600;
    }
    
    .footer-links ul {
      list-style: none;
      padding-left: 0;
    }
    
    .footer-links li {
      margin-bottom: 0.5rem;
    }
    
    .footer-links a {
      color: #6c757d;
      text-decoration: none;
      transition: color 0.3s;
    }
    
    .footer-links a:hover {
      color: var(--primary-color);
    }
    
    .social-icons {
      margin-top: 1rem;
    }
    
    .social-icons a {
      display: inline-block;
      width: 36px;
      height: 36px;
      line-height: 36px;
      text-align: center;
      background-color: #e9ecef;
      color: #495057;
      border-radius: 50%;
      margin-right: 10px;
      transition: all 0.3s;
    }
    
    .social-icons a:hover {
      background-color: var(--primary-color);
      color: white;
      transform: translateY(-3px);
    }
    
    .footer-bottom {
      background-color: #e9ecef;
      padding: 15px 0;
      margin-top: 30px;
    }
    
    .footer-bottom p {
      margin-bottom: 0;
      color: #6c757d;
      font-size: 0.9rem;
    }
    
    .footer-bottom a {
      color: var(--primary-color);
      text-decoration: none;
    }
    
    .footer-bottom a:hover {
      text-decoration: underline;
    }
    
    /* Adjust the fixed footer navigation to account for the new footer */
    .footer-nav {
      bottom: 0;
    }
    
    @media (max-width: 768px) {
      .footer-links {
        margin-bottom: 20px;
      }
    }
    
    /* Add this to your existing styles */
    .footer-main {
      background-color: #f8f9fa;
      padding: 30px 0 0;
      border-top: 1px solid #e9ecef;
      margin-top: auto; /* Push footer to bottom */
    }
    
    /* Only fix footer when home section is active */
    body.home-section-active {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    
    #homeSection {
      flex: 1;
    }
    
    /* Hide footer when other sections are active */
    .section.active-section:not(#homeSection) ~ .footer-main {
      display: none;
    }
    
    /* Category Stories Styling */
    .category-stories {
      padding: 20px 0;
      margin-top: 40px; /* Increased space from header */
      overflow-x: auto;
      white-space: nowrap;
    }
    
    .story-container {
      display: flex;
      gap: 20px;
      justify-content: flex-start; /* Align categories to the left */
    }
    
    .story {
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: pointer;
    }
    
    .story img {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid var(--primary-color);
    }
    
    .story p {
      background-color: var(--primary-color); /* Colored background from additional CSS */
      color: white; /* From additional CSS */
      padding: 5px 10px; /* From additional CSS */
      border-radius: 5px; /* From additional CSS */
      margin-top: 10px; /* From additional CSS */
      font-size: 0.9rem; /* From additional CSS */
    }
    
    /* Category Products Styling */
    .category-products {
      padding: 20px 0;
    }
  </style>
</head>
<body>
  <!-- Toast Container -->
  <div id="toastContainer"></div>
  <!-- Dark Mode Toggle -->
  <div class="dark-mode-toggle" onclick="toggleDarkMode()">
    <i class="bi bi-moon"></i>
  </div>
  <!-- Popup Message Modal -->
  <div class="modal fade" id="popupMessageModal" tabindex="-1" aria-labelledby="popupMessageModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content popup-modal-content">
        <div class="modal-header popup-modal-header">
          <h5 class="modal-title" id="popupMessageModalLabel">Notification</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body popup-modal-body" id="popupMessageContent"></div>
        <div class="modal-footer popup-modal-footer" style="justify-content: center;">
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Okay</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Notifications Section -->
  <div id="notificationsSection" class="section">
    <header class="bg-light py-3 border-bottom">
      <div class="container d-flex justify-content-between align-items-center">
        <button class="btn" onclick="showSection('homeSection')"><i class="far fa-arrow-left"></i> Home</button>
        <h1 class="h5 mb-0">Notifications</h1>
        <button class="btn btn-sm btn-danger" onclick="clearNotifications()">Clear All</button>
      </div>
    </header>
    <div class="container my-4" id="notificationsContent"></div>
  </div>

  <!-- Offcanvas Menu -->
  <div class="offcanvas offcanvas-start" tabindex="-1" id="menuCanvas" aria-labelledby="menuCanvasLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="menuCanvasLabel">Menu</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div id="menuAccountDetails">
      <i class="bi bi-person-circle me-2"></i><span id="menuAccountText">Welcome Guest</span>
    </div>
    <ul class="list-unstyled">
      <li class="custom-menu-item" onclick="hideMenu(); showSection('ordersSection');"><i class="bi bi-receipt me-2"></i> My Orders</li>
      <li id="sellerDashboardMenuItem" class="custom-menu-item" onclick="hideMenu(); showSection('sellerDashboard');" style="display: none;"><i class="bi bi-speedometer me-2"></i> Seller Dashboard</li>
      <li id="ownerDashboardMenuItem" class="custom-menu-item" onclick="hideMenu(); showSection('ownerDashboard');" style="display: none;"><i class="bi bi-graph-up me-2"></i> Owner Dashboard</li>
      <li class="custom-menu-item" onclick="hideMenu(); showSection('aboutSection');"><i class="bi bi-info-circle me-2"></i> About Us</li>
      <li class="custom-menu-item" onclick="hideMenu(); showSection('contactSection');"><i class="bi bi-envelope me-2"></i> Contact Us</li>
      <li class="custom-menu-item" onclick="hideMenu(); showSection('couponsSection');"><i class="bi bi-tag me-2"></i> Coupons</li>
      <li class="custom-menu-item" onclick="hideMenu(); showSection('offerZoneSection');"><i class="bi bi-star me-2"></i> Offer Zone</li>
      <li class="custom-menu-item" onclick="hideMenu(); showSection('helpSection');"><i class="bi bi-question-circle me-2"></i> Help Line</li>
      <li class="custom-menu-item" onclick="hideMenu(); showSection('requestProductSection');"><i class="bi bi-box-seam me-2"></i> Request Product</li>
      <li class="custom-menu-item" onclick="hideMenu(); showSection('feedbackSection');"><i class="bi bi-chat-square-text me-2"></i> Feedback</li>
    </ul>
    <div id="menuSocialSection" class="mt-3 text-center">
      <a href="https://www.instagram.com/nxew.in" target="_blank" class="mx-2"><i class="bi bi-instagram" style="color:#E1306C;"></i></a>
      <a href="https://x.com/TedpoleIn" target="_blank" class="mx-2"><i class="bi bi-twitter" style="color:#1DA1F2;"></i></a>
      <a href="https://www.linkedin.com/in/yourprofile" target="_blank" class="mx-2"><i class="bi bi-linkedin" style="color:#0077B5;"></i></a>
    </div>
  </div>
  
  <!-- Updated Home Section with Category Stories and Products -->
  <div id="homeSection" class="section active-section fade-in">
    <header class="py-3 border-bottom">
      <div class="container d-flex justify-content-between align-items-center">
        <div class="d-flex align-items-center">
          <button class="btn text-dark" data-bs-toggle="offcanvas" data-bs-target="#menuCanvas" aria-controls="menuCanvas" aria-label="Toggle Menu">
            <i class="bi bi-list"></i>
          </button>
          <img src="https://i.pinimg.com/736x/d5/e5/4e/d5e54e8444e36458688888e4c84b5419.jpg" alt="NXew Logo" width="120" height="50" style="vertical-align: middle;">
        </div>
        <h1 class="h5 mb-0 text-dark">
          <span id="headerProfile" class="profile-name"></span>
        </h1>
        <nav class="header-nav">
          <button class="btn text-dark" id="notificationButton" aria-label="Notifications">
            <i class="bi bi-bell"></i>
          </button>
          <button class="btn text-dark" id="accountButton" aria-label="Account">
            <i class="bi bi-person"></i>
          </button>
        </nav>
      </div>
    </header>
    <section class="category-stories">
      <div class="container">
        <div class="story-container">
          <div class="story" onclick="filterShopByCategory('T-Shirts')">
            <img src="https://i.pinimg.com/736x/99/df/c6/99dfc6172b5df9a97c22d2af93aac789.jpg" alt="T-Shirts">
            <p>T-Shirts</p>
          </div>
          <div class="story" onclick="filterShopByCategory('sweat T-Shirts')">
            <img src="https://i.pinimg.com/736x/94/2a/e4/942ae43485ba186ee70c0087bd4ade89.jpg" alt="sweat T-Shirts">
            <p>sweat T-Shirts</p>
          </div>
          <div class="story" onclick="filterShopByCategory('Half sleeve Shirts')">
            <img src="https://i.pinimg.com/736x/ca/d0/dd/cad0dd3c7f3880dee714da8bdecdf723.jpg" alt="Half sleeve Shirts">
            <p>Half sleeve Shirts</p>
          </div>
        </div>
      </div>
    </section>
    <section class="category-products">
      <div class="container">
        <div class="row" id="categoryProductsContainer"></div>
      </div>
    </section>
    <section class="product-highlight">
      <div class="full-screen-wrapper">
        <div id="productHighlightCarousel" class="carousel slide full-screen-carousel carousel-fade" data-bs-ride="carousel" data-bs-interval="3000">
          <div class="carousel-indicators">
            <button type="button" data-bs-target="#productHighlightCarousel" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
            <button type="button" data-bs-target="#productHighlightCarousel" data-bs-slide-to="1" aria-label="Slide 2"></button>
            <button type="button" data-bs-target="#productHighlightCarousel" data-bs-slide-to="2" aria-label="Slide 3"></button>
          </div>
          <div class="carousel-inner">
            <div class="carousel-item active" onclick="showSection('shopSection')">
              <img src="https://i.pinimg.com/736x/b4/2d/60/b42d607bf8fd050db2875505389c87cd.jpg" class="d-block w-100" alt="Product Highlight 1">
              <div class="carousel-caption d-none d-md-block">
                <h5>Luxury in Every Stitch</h5>
                <p>Clothing is a form of self-expression.</p>
              </div>
            </div>
            <div class="carousel-item" onclick="filterShopByCategory('sweat T-Shirts')">
              <img src="https://i.pinimg.com/736x/94/2a/e4/942ae43485ba186ee70c0087bd4ade89.jpg" class="d-block w-100" alt="Product Highlight 2">
              <div class="carousel-caption d-none d-md-block">
                <h5>Trendy Men's Wear</h5>
                <p>Explore our latest collection.</p>
              </div>
            </div>
            <div class="carousel-item" onclick="filterShopByCategory('T-Shirts')">
              <img src="https://i.pinimg.com/736x/99/df/c6/99dfc6172b5df9a97c22d2af93aac789.jpg" class="d-block w-100" alt="Product Highlight 3">
              <div class="carousel-caption d-none d-md-block">
                <h5>Stylish Accessories</h5>
                <p>Complete your look.</p>
              </div>
            </div> 
          </div>
          <button class="carousel-control-prev" type="button" data-bs-target="#productHighlightCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#productHighlightCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
          </button>
        </div>
      </div>
    </section>
    <!-- New Featured Products Section -->
    <section class="featured-products py-5">
      <div class="container">
        <h2 class="text-center mb-4">Featured Products</h2>
        <div class="row" id="featuredProductsContainer"></div>
      </div>
    </section>
  </div>

  <!-- About Us Section -->
  <div id="aboutSection" class="section fade-in">
    <header class="py-3 border-bottom bg-light">
      <div class="container d-flex justify-content-between align-items-center">
        <button class="btn" onclick="showSection('homeSection')" aria-label="Back"><i class="bi bi-arrow-left"></i> Home</button>
        <h1 class="h5 mb-0">About Us</h1>
        <div></div>
      </div>
    </header>
    <div class="container my-4">
      <p>We are a premium clothing and accessories store dedicated to providing high-quality products and exceptional customer service. Our passion is to make you look and feel your best.</p>
    </div>
  </div>

  <!-- Contact Us Section -->
  <div id="contactSection" class="section fade-in">
    <header class="py-3 border-bottom bg-light">
      <div class="container d-flex justify-content-between align-items-center">
        <button class="btn" onclick="showSection('homeSection')" aria-label="Back to Home"><i class="bi bi-arrow-left"></i> Home</button>
        <h1 class="h5 mb-0">Contact Us</h1>
        <div></div>
      </div>
    </header>
    <div class="container my-4">
      <form id="contactForm">
        <div class="mb-3">
          <label for="contactName" class="form-label">Name</label>
          <input type="text" class="form-control" id="contactName" placeholder="Your Name" required aria-label="Your Name" />
        </div>
        <div class="mb-3">
          <label for="contactEmail" class="form-label">Email Address</label>
          <input type="email" class="form-control" id="contactEmail" placeholder="Your Email" required aria-label="Your Email" />
        </div>
        <div class="mb-3">
          <label for="contactQuestion" class="form-label">Question</label>
          <textarea class="form-control" id="contactQuestion" placeholder="Your Question" required aria-label="Your Question"></textarea>
        </div>
        <button type="submit" class="btn btn-primary" aria-label="Send Message">Send</button>
      </form>
    </div>
  </div>

  <!-- Coupons Section -->
  <div id="couponsSection" class="section fade-in">
    <header class="py-3 border-bottom bg-light">
      <div class="container d-flex justify-content-between align-items-center">
        <button class="btn" onclick="showSection('homeSection')" aria-label="Back to Home"><i class="bi bi-arrow-left"></i> Home</button>
        <h1 class="h5 mb-0">Coupons</h1>
        <div></div>
      </div>
    </header>
    <div class="container my-4">
      <h2>Available Coupons</h2>
      <div class="row">
        <div class="col-md-6 mb-4">
          <div class="card shadow-sm">
            <div class="card-body">
              <h5 class="card-title"><i class="bi bi-tag-fill me-2"></i>SUMMER20</h5>
              <p class="card-text">20% off on total purchase</p>
              <p class="card-text"><small class="text-muted">Valid until 30th September 2025</small></p>
            </div>
          </div>
        </div>
        <div class="col-md-6 mb-4">
          <div class="card shadow-sm">
            <div class="card-body">
              <h5 class="card-title"><i class="bi bi-tag-fill me-2"></i>WELCOME10</h5>
              <p class="card-text">10% off for new customers</p>
              <p class="card-text"><small class="text-muted">Valid until 31st October 2025</small></p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Offer Zone Section -->
  <div id="offerZoneSection" class="section fade-in">
    <header class="py-3 border-bottom bg-light">
      <div class="container d-flex justify-content-between align-items-center">
        <button class="btn" onclick="showSection('homeSection')" aria-label="Back to Home"><i class="bi bi-arrow-left"></i> Home</button>
        <h1 class="h5 mb-0">Offer Zone</h1>
        <div></div>
      </div>
    </header>
    <div class="container my-4">
      <h2>Current Offers</h2>
      <div class="row">
        <div class="col-md-6 mb-4">
          <div class="card shadow-sm">
            <div class="card-body">
              <h5 class="card-title"><i class="bi bi-percent me-2"></i>20% off on all products</h5>
              <p class="card-text">Get 20% discount on Products. Coupon required.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Help Line Section -->
  <div id="helpSection" class="section fade-in">
    <header class="py-3 border-bottom bg-light">
      <div class="container d-flex justify-content-between align-items-center">
        <button class="btn" onclick="showSection('homeSection')" aria-label="Back to Home"><i class="bi bi-arrow-left"></i> Home</button>
        <h1 class="h5 mb-0">Help Line</h1>
        <div></div>
      </div>
    </header>
    <div class="container my-4">
      <p>For assistance, please call <strong>+91 7661838006</strong> or email us at <strong>tedpole.in@gmail.com</strong>.</p>
    </div>
  </div>
  
  <!-- Updated Search Section -->
  <div id="searchSection" class="section fade-in" style="position: relative;">
    <header class="py-3 border-bottom bg-light">
      <div class="container d-flex justify-content-between align-items-center">
        <button class="btn" onclick="showSection('homeSection')" aria-label="Back to Home">
          <i class="bi bi-arrow-left"></i> Home
        </button>
        <h1 class="h5 mb-0">Search Products</h1>
        <div></div>
      </div>
    </header>
    <div class="container mt-5 my-4">
      <div class="search-container mb-4">
        <button class="btn btn-dark" type="button" id="searchSectionButton" aria-label="Search" onclick="toggleSearchBar()">
          <i class="bi bi-search"></i>
        </button>
        <div id="searchBarContainer" style="display: none; flex-grow: 1; margin-left: 10px;">
          <input type="text" class="form-control" placeholder="Search for shirts, pants, accessories..." 
                 id="searchSectionInput" autocomplete="off" aria-label="Search for Products"
                 onkeyup="handleSearchInput()">
        </div>
        <button class="btn btn-outline-secondary" type="button" id="voiceSearchButton" aria-label="Search by Voice" onclick="startVoiceSearch()">
          <i class="bi bi-mic"></i>
        </button>
        <div id="searchSuggestions" class="search-suggestions"></div>
      </div>
      <div class="search-results-container">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 id="searchResultsCount">0 products found</h5>
          <div id="searchActiveFilters"></div>
        </div>
        <div class="row" id="searchResultsContainer"></div>
      </div>
      <button class="draggable-filter" data-bs-toggle="modal" data-bs-target="#searchFilterModal" aria-label="Filter Search">
        <i class="bi bi-funnel"></i>
      </button>
    </div>
  </div>
  
  <!-- Search Filter Modal -->
  <div class="modal fade" id="searchFilterModal" tabindex="-1" aria-labelledby="searchFilterModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="searchFilterModalLabel">Filter Products</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="row g-3">
            <div class="col-md-6">
              <label for="searchCategory" class="form-label">Category</label>
              <select id="searchCategory" class="form-select">
                <option value="">All Categories</option>
                <option value="Baggy Jeans">Baggy Jeans</option>
                <option value="Polos">Polos</option>
              </select>
            </div>
            <div class="col-md-6">
              <label for="searchPrice" class="form-label">Price Range</label>
              <select id="searchPrice" class="form-select">
                <option value="">All Prices</option>
                <option value="0-100">Under ₹100</option>
                <option value="100-200">₹100 - ₹200</option>
                <option value="200-300">₹200 - ₹300</option>
                <option value="300-500">₹300 - ₹500</option>
                <option value="500">Above ₹500</option>
              </select>
            </div>
            <div class="col-md-6">
              <label for="searchRating" class="form-label">Minimum Rating</label>
              <select id="searchRating" class="form-select">
                <option value="">Any Rating</option>
                <option value="4">4+ Stars</option>
                <option value="3">3+ Stars</option>
                <option value="2">2+ Stars</option>
                <option value="1">1+ Star</option>
              </select>
            </div>
            <div class="col-md-6">
              <label for="searchSort" class="form-label">Sort By</label>
              <select id="searchSort" class="form-select">
                <option value="relevance">Relevance</option>
                <option value="price-low">Price: Low to High</option>
                <option value="price-high">Price: High to Low</option>
                <option value="rating">Highest Rated</option>
                <option value="newest">Newest Arrivals</option>
              </select>
            </div>
            <div class="col-md-6">
              <label for="searchSize" class="form-label">Size</label>
              <select id="searchSize" class="form-select">
                <option value="">All Sizes</option>
                <option value="S">S</option>
                <option value="M">M</option>
                <option value="L">L</option>
                <option value="XL">XL</option>
                <option value="32">32</option>
                <option value="34">34</option>
                <option value="36">36</option>
                <option value="One Size">One Size</option>
              </select>
            </div>
            <div class="col-md-6">
              <label for="searchColor" class="form-label">Color</label>
              <select id="searchColor" class="form-select">
                <option value="">All Colors</option>
                <option value="Blue">Blue</option>
                <option value="Red">Red</option>
                <option value="Black">Black</option>
                <option value="Brown">Brown</option>
                <option value="White">White</option>
                <option value="Silver">Silver</option>
              </select>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" onclick="clearSearchFilters()" data-bs-dismiss="modal">Clear Filters</button>
          <button type="button" class="btn btn-primary" onclick="performSearch()" data-bs-dismiss="modal">Apply Filters</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Login Section -->
  <div id="loginSection" class="section fade-in">
    <header class="bg-light py-3 border-bottom">
      <div class="container d-flex justify-content-between align-items-center">
        <button class="btn" onclick="showSection('homeSection')" aria-label="Back to Home"><i class="bi bi-arrow-left"></i> Home</button>
        <h1 class="h5 mb-0">Login</h1>
        <div></div>
      </div>
    </header>
    <div class="container my-4">
      <div class="row justify-content-center">
        <div class="col-12">
          <div class="card shadow-sm">
            <div class="card-body">
              <form id="loginForm">
                <div class="mb-3">
                  <label for="loginEmail" class="form-label">Email Address</label>
                  <input type="email" class="form-control" id="loginEmail" placeholder="Enter your email" required aria-label="Email Address" />
                </div>
                <div class="mb-3">
                  <label for="loginPassword" class="form-label">Password</label>
                  <input type="password" class="form-control" id="loginPassword" placeholder="Enter your password" required minlength="6" aria-label="Password" />
                </div>
                <button type="submit" class="btn btn-primary w-100" aria-label="Login to your account">Login</button>
              </form>
              <p class="mt-3 text-center">Don't have an account? <a href="#" onclick="showSection('signupSection')">Sign Up</a></p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Signup Section -->
  <div id="signupSection" class="section fade-in">
    <header class="bg-light py-3 border-bottom">
      <div class="container d-flex justify-content-between align-items-center">
        <button class="btn" onclick="showSection('homeSection')" aria-label="Back to Home"><i class="bi bi-arrow-left"></i> Home</button>
        <h1 class="h5 mb-0">Sign Up</h1>
        <div></div>
      </div>
    </header>
    <div class="container my-4">
      <div class="row justify-content-center">
        <div class="col-12">
          <div class="card shadow-sm">
            <div class="card-body">
              <form id="signupForm">
                <div class="row">
                  <div class="col-6 mb-3">
                    <label for="firstName" class="form-label">First Name</label>
                    <input type="text" class="form-control" id="firstName" placeholder="First Name" required aria-label="First Name" />
                  </div>
                  <div class="col-6 mb-3">
                    <label for="lastName" class="form-label">Last Name</label>
                    <input type="text" class="form-control" id="lastName" placeholder="Last Name" required aria-label="Last Name" />
                  </div>
                </div>
                <div class="mb-3">
                  <label for="mobileNumberSignUp" class="form-label">Mobile Number</label>
                  <input type="text" class="form-control" id="mobileNumberSignUp" placeholder="Enter your mobile number" required aria-label="Mobile Number" />
                </div>
                <div class="mb-3">
                  <label for="signupEmail" class="form-label">Email Address</label>
                  <input type="email" class="form-control" id="signupEmail" placeholder="Enter your email" required aria-label="Email Address" />
                </div>
                <div class="row">
                  <div class="col-6 mb-3">
                    <label for="signupPassword" class="form-label">Password</label>
                    <input type="password" class="form-control" id="signupPassword" placeholder="Password" required minlength="6" aria-label="Password" />
                  </div>
                  <div class="col-6 mb-3">
                    <label for="confirmPassword" class="form-label">Confirm Password</label>
                    <input type="password" class="form-control" id="confirmPassword" placeholder="Confirm Password" required minlength="6" aria-label="Confirm Password" />
                  </div>
                </div>
                <button type="submit" class="btn btn-primary w-100" aria-label="Sign Up">Sign Up</button>
              </form>
              <!-- Added "Signup with W-Link" button with NXew logo -->
              <div class="mt-3 text-center">
                <button class="btn btn-outline-primary" onclick="signupWithTMail()" aria-label="Signup with W-Link">
                  <img src="https://i.pinimg.com/736x/d5/e5/4e/d5e54e8444e36458688888e4c84b5419.jpg" alt="W-Link Logo" style="width: 80px; height: 50px; margin-right: 8px;">
                  Signup with W-Mail
                </button>
              </div>
              <p class="mt-3 text-center">Already have an account? <a href="#" onclick="showSection('loginSection')">Login</a></p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Account Section -->
  <div id="accountSection" class="section fade-in">
    <header class="py-3 border-bottom bg-light">
      <div class="container d-flex justify-content-between align-items-center">
        <button class="btn" onclick="showSection('homeSection')" aria-label="Back to Home"><i class="bi bi-arrow-left"></i> Home</button>
        <h1 class="h5 mb-0">My Account</h1>
        <div></div>
      </div>
    </header>
    <div class="container my-4" id="accountContent"></div>
  </div>

  <!-- Cart Section -->
  <div id="cartSection" class="section fade-in">
    <header class="py-3 border-bottom bg-light">
      <div class="container d-flex justify-content-between align-items-center">
        <button class="btn" onclick="showSection('homeSection')" aria-label="Back to Home"><i class="bi bi-arrow-left"></i> Home</button>
        <h1 class="h5 mb-0">Your Bag</h1>
        <div></div>
      </div>
    </header>
    <div class="container my-4" id="cartContent"></div>
  </div>

  <!-- Shop Section -->
  <div id="shopSection" class="section fade-in">
    <header class="py-3 border-bottom bg-light">
      <div class="container d-flex justify-content-between align-items-center">
        <button class="btn" onclick="showSection('homeSection')" aria-label="Back to Home"><i class="bi bi-arrow-left"></i> Home</button>
        <h1 class="h5 mb-0">All Products</h1>
        <div></div>
      </div>
    </header>
    <div class="container my-4">
      <div class="row">
        <div class="col-12">
          <h5 id="shopResultsCount">All products</h5>
        </div>
      </div>
      <div class="row" id="shopProductContainer"></div>
    </div>
  </div>
  
  <!-- Enhanced Orders Section -->
  <div id="ordersSection" class="section fade-in">
    <header class="py-3 border-bottom bg-light">
      <div class="container d-flex justify-content-between align-items-center">
        <button class="btn" onclick="showSection('homeSection')" aria-label="Back to Home"><i class="bi bi-arrow-left"></i> Home</button>
        <h1 class="h5 mb-0">My Orders</h1>
        <div class="dropdown">
          <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="ordersFilterDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            Filter Orders
          </button>
          <ul class="dropdown-menu" aria-labelledby="ordersFilterDropdown">
            <li><a class="dropdown-item" href="#" onclick="filterOrders('all')">All Orders</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="#" onclick="filterOrders('active')">Active Orders</a></li>
            <li><a class="dropdown-item" href="#" onclick="filterOrders('completed')">Completed Orders</a></li>
          </ul>
        </div>
      </div>
    </header>
    <div class="container my-4" id="ordersList"></div>
  </div>

 <!-- Order Detail Section -->
  <div id="orderDetailSection" class="section fade-in">
    <header class="py-3 border-bottom bg-light">
      <div class="container d-flex justify-content-between align-items-center">
        <button class="btn" onclick="showSection('ordersSection')" aria-label="Back to Orders"><i class="bi bi-arrow-left"></i> Back to Orders</button>
        <h1 class="h5 mb-0">Order Details</h1>
        <div></div>
      </div>
    </header>
    <div class="container my-4" id="orderDetailPage">
      <!-- Example Order Detail with QR Code Button -->
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title">Order #12345</h5>
          <p class="card-text">Status: <span id="orderStatusDetail">Processing</span></p>
          <button class="btn btn-sm btn-outline-secondary show-qr-code" data-order-id="12345">
            <i class="bi bi-qr-code"></i> Get QR Code
          </button>
        </div>
      </div>
    </div>
  </div>

   <!-- Product Detail Section -->
   <div id="productDetailSection" class="section fade-in">
    <header class="py-3 border-bottom bg-light">
      <div class="container d-flex justify-content-between align-items-center">
        <button class="btn" onclick="showSection('searchSection')" aria-label="Back"><i class="bi bi-arrow-left"></i> Back</button><h1 class="h5 mb-0">Search Details</h1>
        <div></div>
      </div>
    </header>
    <div class="container my-4" id="productDetailPage"></div>
  </div>
  <!-- Request Product Section -->
  <div id="requestProductSection" class="section fade-in">
    <header class="py-3 border-bottom bg-light">
      <div class="container d-flex justify-content-between align-items-center">
        <button class="btn" onclick="showSection('homeSection')" aria-label="Back to Home">
          <i class="bi bi-arrow-left"></i> Home
        </button>
        <h1 class="h5 mb-0">Request Product</h1>
        <div></div>
      </div>
    </header>
    <div class="container my-4">
      <form id="requestProductForm">
        <div class="mb-3">
          <label for="requestCategory" class="form-label">Category</label>
          <select class="form-select" id="requestCategory" required>
            <option value="">Select Category</option>
            <option value="Baggy Jeans">Baggy Jeans</option>
            <option value="Polos">Polos</option>
            <option value="T-Shirts">T-Shirts</option>
          </select>
        </div>
        <div class="mb-3">
          <label for="requestClothType" class="form-label">Cloth Type</label>
          <input type="text" class="form-control" id="requestClothType" placeholder="e.g., Cotton, Denim" required>
        </div>
        <div class="mb-3">
          <label for="requestSize" class="form-label">Size</label>
          <input type="text" class="form-control" id="requestSize" placeholder="e.g., M, 32, One Size" required>
        </div>
        <div class="mb-3">
          <label for="requestColor" class="form-label">Color</label>
          <input type="text" class="form-control" id="requestColor" placeholder="e.g., Blue, Black" required>
        </div>
        <div class="mb-3">
          <label for="requestMessage" class="form-label">Additional Message</label>
          <textarea class="form-control" id="requestMessage" rows="3" placeholder="Any additional details or requests"></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Send Request</button>
      </form>
    </div>
  </div>
  <!-- Feedback Section -->
<div id="feedbackSection" class="section fade-in">
  <header class="py-3 border-bottom bg-light">
    <div class="container d-flex justify-content-between align-items-center">
      <button class="btn" onclick="showSection('homeSection')" aria-label="Back to Home"><i class="bi bi-arrow-left"></i> Home</button>
      <h1 class="h5 mb-0">Feedback</h1>
      <div></div>
    </div>
  </header>
  <div class="container my-4">
    <form id="feedbackForm">
      <div class="mb-3">
        <label for="feedbackMessage" class="form-label">Your Feedback</label>
        <textarea class="form-control" id="feedbackMessage" rows="5" placeholder="Share your thoughts or suggestions" required aria-label="Feedback Message"></textarea>
      </div>
      <button type="submit" class="btn btn-primary" aria-label="Submit Feedback">Submit Feedback</button>
    </form>
  </div>
</div>
     <!-- Buy Now Modal -->
     <div class="modal fade" id="buyModal" tabindex="-1" aria-labelledby="buyModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="buyModalLabel">Buy Now</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <form id="buyForm">
            <div class="modal-body">
              <!-- EmailJS required hidden fields -->
             <input type="hidden" name="product" id="emailProduct">
<input type="hidden" name="price" id="emailPrice">
<input type="hidden" name="size" id="emailSize">
<input type="hidden" name="color" id="emailColor">
            <div class="mb-3">
              <label for="shippingAddress" class="form-label">Address</label>
              <textarea class="form-control" id="shippingAddress" required aria-label="Shipping Address"></textarea>
            </div>
            <div class="mb-3">
              <label for="mobileNumber" class="form-label">Mobile Number</label>
              <input type="text" class="form-control" id="mobileNumber" required aria-label="Mobile Number" />
            </div>
            <div class="mb-3">
              <label for="additionalDetails" class="form-label">Additional Details</label>
              <textarea class="form-control" id="additionalDetails" aria-label="Additional Details"></textarea>
            </div>
            <div class="mb-3">
              <label class="form-label">Payment Method</label>
              <input type="text" class="form-control" value="Cash on Delivery" disabled aria-label="Payment Method" />
            </div>
            <div id="offerInfo" class="mb-3"></div>
            <div class="mb-3">
              <label for="couponCode" class="form-label">Coupon Code</label>
              <div class="input-group">
                <input type="text" class="form-control" id="couponCode" placeholder="Enter coupon code" aria-label="Coupon Code">
                <button type="button" class="btn btn-outline-secondary" id="applyCouponButton">Apply</button>
              </div>
              <p id="couponMessage" class="mt-2"></p>
            </div>
            <p id="couponMessage" class="mb-3"></p>
            <div class="mb-3">
              <p><strong>Product:</strong> <span id="modalProductName"></span></p>
              <p><strong>Size:</strong> <span id="modalProductSize"></span></p>
              <p><strong>Color:</strong> <span id="modalProductColor"></span></p>
              <p><strong>Price:</strong> ₹<span id="modalProductPrice"></span></p>
              <p><strong>Shipping:</strong> FREE</p>
              <p><strong>Estimated Delivery:</strong> <span id="modalDeliveryTime"></span></p>
              <p><strong>Total Amount:</strong> ₹<span id="modalTotalAmount"></span></p>
            </div>
            <hr />
            <button type="submit" class="btn btn-primary">Confirm Order</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="productImagesModal" tabindex="-1" aria-labelledby="productImagesModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="productImagesModalLabel">Product Images</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div id="productCarousel" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-inner" id="carouselInner"></div>
            <button class="carousel-control-prev" type="button" data-bs-target="#productCarousel" data-bs-slide="prev">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#productCarousel" data-bs-slide="next">
              <span class="carousel-control-next-icon" aria-hidden="true"></span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <script>
  function showProductImagesModal(productId) {
    const product = products.find(p => p.id === productId);
    const carouselInner = document.getElementById("carouselInner");
    carouselInner.innerHTML = "";
  
    product.images.forEach((img, index) => {
      carouselInner.innerHTML += `
        <div class="carousel-item ${index === 0 ? 'active' : ''}">
          <img src="${img}" class="d-block w-100" alt="${product.name}">
        </div>
      `;
    });
  
    new bootstrap.Modal(document.getElementById('productImagesModal')).show();
  }
  // Mock function to simulate real-time order status (replace with API call later)
function getOrderStatus(orderId) {
  return new Promise((resolve) => {
    setTimeout(() => {
      const order = orders[parseInt(orderId) - 1];
      if (!order) {
        resolve(null);
        return;
      }
      // Simulate status progression based on current state
      const statuses = [
        { status: 'Processing', icon: 'bi-box' },
        { status: 'Shipped', icon: 'bi-truck' },
        { status: 'Out for Delivery', icon: 'bi-geo-alt' },
        { status: 'Delivered', icon: 'bi-check-circle' }
      ];
      let currentIndex = statuses.findIndex(s => s.status === order.trackingStatus);
      if (currentIndex === -1) currentIndex = 0;
      if (order.received) currentIndex = 3; // Delivered
      else if (order.shipped && currentIndex < 2) currentIndex = 1; // Shipped
      const timeline = statuses.slice(0, currentIndex + 1).map((s, i) => ({
        status: s.status,
        icon: s.icon,
        timestamp: i === currentIndex ? new Date().toLocaleString() : order.date
      }));
      resolve({ status: statuses[currentIndex].status, timeline });
    }, 1000); // Simulate network delay
  });
}

// Function to update the UI with order status
function updateOrderStatus(statusData) {
  const statusContainer = document.getElementById('orderStatus');
  const timelineContainer = document.getElementById('orderTimeline');
  if (!statusData) {
    statusContainer.textContent = 'Order not found';
    timelineContainer.innerHTML = '';
    return;
  }
  statusContainer.textContent = statusData.status;
  let timelineHtml = '';
  statusData.timeline.forEach(event => {
    timelineHtml += `
      <div class="d-flex align-items-center mb-2">
        <i class="bi ${event.icon} me-2" style="color: var(--success-color);"></i>
        <div>
          <strong>${event.status}</strong>
          <p class="mb-0 text-muted">${event.timestamp}</p>
        </div>
      </div>
    `;
  });
  timelineContainer.innerHTML = timelineHtml;
}

// Start periodic tracking updates
function startOrderTracking(orderId) {
  setInterval(async () => {
    try {
      const statusData = await getOrderStatus(orderId);
      updateOrderStatus(statusData);
    } catch (error) {
      console.error('Error updating order status:', error);
    }
  }, 30000); // Update every 30 seconds
}

// Event listener for track order button
document.getElementById('trackOrderButton')?.addEventListener('click', async () => {
  const orderId = document.getElementById('orderIdInput').value.trim();
  if (!orderId || isNaN(orderId) || orderId <= 0) {
    showNotification('Please enter a valid order ID', 'warning');
    return;
  }
  document.getElementById('orderStatusContainer').style.display = 'block';
  document.getElementById('orderStatus').textContent = 'Loading...';
  try {
    const statusData = await getOrderStatus(orderId);
    if (statusData) {
      updateOrderStatus(statusData);
      startOrderTracking(orderId);
      showNotification(`Tracking started for Order #${orderId}`, 'success');
    } else {
      updateOrderStatus(null);
      showNotification(`Order #${orderId} not found`, 'danger');
    }
  } catch (error) {
    showNotification('Error fetching order status', 'danger');
    document.getElementById('orderStatus').textContent = 'Error';
  }
});
  </script>

  <!-- Track Order Modal -->
  <div class="modal fade" id="trackOrderModal" tabindex="-1" aria-labelledby="trackOrderModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content shadow-sm">
        <div class="modal-header">
          <h5 class="modal-title" id="trackOrderModalLabel">Track Order</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="trackOrderContent"></div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  
  <div class="modal fade" id="sendMessageModal" tabindex="-1" aria-labelledby="sendMessageModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="sendMessageModalLabel">Send Message to User</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <textarea class="form-control" id="messageText" rows="3" placeholder="Type your message here..."></textarea>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" onclick="confirmSendMessage()">Send</button>
        </div>
      </div>
    </div>
  </div>
  <!-- Main Footer Section -->
  <footer class="footer-main">
    <div class="container">
      <div class="row">
        <div class="col-md-4 footer-links">
          <h5>Quick Links</h5>
          <ul>
            <li><a href="#" onclick="showSection('homeSection')">Home</a></li>
            <li><a href="#" onclick="showSection('offerZoneSection')">Offer Zone</a></li>
          </ul>
        </div>
        
        <div class="col-md-4 footer-links">
          <h5>Customer Service</h5>
          <ul>
            <li><a href="#" onclick="showSection('contactSection')">Contact Us</a></li>
            <li><a href="#" onclick="showSection('helpSection')">Help & FAQ</a></li>
            <li><a href="#" onclick="showSection('ordersSection')">Track Order</a></li>
          </ul>
        </div>
        
        <div class="col-md-4 footer-links">
          <h5>Connect With Us</h5>
          <p>Follow NXew on social media for updates and offers</p>
          <div class="social-icons">
            <a href="https://www.instagram.com/nxew.in" target="_blank" aria-label="Instagram"><i class="bi bi-instagram"></i></a>
            <a href="https://x.com/TedpoleIn" target="_blank" aria-label="Twitter"><i class="bi bi-twitter"></i></a>
            <a href="https://www.facebook.com/yourpage" target="_blank" aria-label="Facebook"><i class="bi bi-facebook"></i></a>
            <a href="https://www.linkedin.com/company/tedpole" target="_blank" aria-label="LinkedIn"><i class="bi bi-linkedin"></i></a>
          </div>
        </div>
      </div>
    <div class="footer-bottom">
      <div class="container">
        <div class="row">
          <div class="col-md-6">
            <p>© 2025 NXew. All rights reserved.</p>
          </div>
          <div class="col-md-6 text-md-end">
            <p>
              <a href="#" data-bs-toggle="modal" data-bs-target="#termsModal">Terms & Conditions</a> | 
              <a href="#" data-bs-toggle="modal" data-bs-target="#privacyModal">Privacy Policy</a>
            </p>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <!-- Terms & Conditions Modal -->
  <div class="modal fade" id="termsModal" tabindex="-1" aria-labelledby="termsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="termsModalLabel">Terms & Conditions</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <h6>1. General Terms</h6>
          <p>By accessing and placing an order with NXew, you confirm that you are in agreement with and bound by the terms and conditions contained in these Terms & Conditions.</p>
          
          <h6 class="mt-3">2. Products</h6>
          <p>We strive to display as accurately as possible the colors, features, specifications, and details of the products available on our store. However, we do not guarantee that the colors, features, specifications, and details of the products will be accurate, complete, reliable, current, or free of other errors.</p>
          
          <h6 class="mt-3">3. Pricing</h6>
          <p>All prices are in INR (Indian Rupees) and are exclusive of taxes. NXew reserves the right to change prices for products displayed at any time, and to correct pricing errors that may inadvertently occur.</p>
          
          <h6 class="mt-3">4. Orders</h6>
          <p>When you place an order, you will receive an acknowledgment e-mail confirming receipt of your order. This email will only be an acknowledgment and will not constitute acceptance of your order.</p>
          
          <h6 class="mt-3">5. Shipping</h6>
          <p>We aim to ship all orders within 1-3 business days. Delivery times are estimates and commence from the date of shipping, rather than the date of order.</p>
          
          <h6 class="mt-3">6. Returns & Refunds</h6>
          <p>We accept returns within 10 days of receipt for most items in new, unused condition with original packaging. Refunds will be issued to the original payment method.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

 <!-- Privacy Policy Modal -->
  <div class="modal fade" id="privacyModal" tabindex="-1" aria-labelledby="privacyModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="privacyModalLabel">Privacy Policy</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <h6>1. Information We Collect</h6>
          <p>We collect personal information that you provide to us such as name, address, contact information, payment information, and any other information you give us when you place an order or create an account.</p>
          
          <h6 class="mt-3">2. How We Use Your Information</h6>
          <p>We use the information we collect to process your orders, communicate with you about orders, products, services and promotional offers, update our records and generally maintain your accounts with us.</p>
          
          <h6 class="mt-3">3. Information Sharing</h6>
          <p>We do not sell or rent your personal information to third parties. We may share your information with service providers who perform services on our behalf, such as payment processing, order fulfillment, and marketing assistance.</p>
          
          <h6 class="mt-3">4. Security</h6>
          <p>We implement a variety of security measures to maintain the safety of your personal information when you place an order or enter, submit, or access your personal information.</p>
          
          <h6 class="mt-3">5. Cookies</h6>
          <p>We use cookies to help us remember and process the items in your shopping cart, understand and save your preferences for future visits and compile aggregate data about site traffic and site interaction.</p>
          
          <h6 class="mt-3">6. Changes to This Policy</h6>
          <p>We may update this Privacy Policy from time to time in order to reflect changes to our practices or for other operational, legal or regulatory reasons.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Fixed Footer Navigation -->
  <footer class="footer-nav fixed-bottom">
    <div class="container">
      <ul class="nav-list">
        <li class="nav-item">
          <a href="#" class="nav-link" data-section="homeSection" onclick="showSection('homeSection'); return false;" aria-label="Home">
            <i class="bi bi-house"></i>
          </a>
        </li>
        <li class="nav-item">
          <a href="#" class="nav-link" data-section="searchSection" onclick="showSection('searchSection'); return false;" aria-label="Search">
            <i class="bi bi-search"></i>
          </a>
        </li>
        <li class="nav-item">
          <a href="#" class="nav-link" data-section="cartSection" onclick="showSection('cartSection'); return false;" aria-label="Your Bag">
            <i class="bi bi-bag"></i>
            <span class="badge" id="footerBagBadge">0</span>
          </a>
        </li>
      </ul>
    </div>
  </footer>
<!-- Cancel Order Modal -->
  <div class="modal fade" id="cancelOrderModal" tabindex="-1" aria-labelledby="cancelOrderModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="cancelOrderModalLabel">Cancel Order</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p>Please provide details for order cancellation:</p>
          <form id="cancelOrderForm">
            <div class="mb-3">
              <label for="cancelReason" class="form-label">Reason for cancellation</label>
              <select class="form-select" id="cancelReason" required>
                <option value="">Select a reason</option>
                <option value="Found better price elsewhere">Found better price elsewhere</option>
                <option value="No longer needed">No longer needed</option>
                <option value="Shipping takes too long">Shipping takes too long</option>
                <option value="Ordered by mistake">Ordered by mistake</option>
                <option value="Other">Other (please specify)</option>
              </select>
            </div>
            <div class="mb-3" id="otherReasonContainer" style="display: none;">
              <label for="otherReason" class="form-label">Please specify</label>
              <textarea class="form-control" id="otherReason" rows="2"></textarea>
            </div>
            <div class="mb-3">
              <label for="cancelAddress" class="form-label">Your Address</label>
              <textarea class="form-control" id="cancelAddress" required placeholder="Enter your address"></textarea>
            </div>
            <div class="mb-3">
              <label for="cancelMobile" class="form-label">Mobile Number</label>
              <input type="text" class="form-control" id="cancelMobile" required placeholder="Enter your mobile number" />
            </div>
            <div class="mb-3">
              <label for="cancelDetails" class="form-label">Additional Details</label>
              <textarea class="form-control" id="cancelDetails" rows="3" placeholder="Any additional details about cancellation"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-danger" onclick="confirmCancelOrder()">Submit Cancellation</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Return Order Modal -->
  <div class="modal fade" id="returnOrderModal" tabindex="-1" aria-labelledby="returnOrderModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="returnOrderModalLabel">Return Item</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p>Please tell us why you're returning this item:</p>
          <div class="mb-3">
            <label for="returnReason" class="form-label">Reason for return</label>
            <select class="form-select" id="returnReason">
              <option value="">Select a reason</option>
              <option value="Wrong size or fit">Wrong size or fit</option>
              <option value="Item damaged or defective">Item damaged or defective</option>
              <option value="Not as described">Not as described</option>
              <option value="Changed my mind">Changed my mind</option>
              <option value="Other">Other (please specify)</option>
            </select>
          </div>
          <div class="mb-3" id="returnOtherReasonContainer" style="display: none;">
            <label for="returnOtherReason" class="form-label">Please specify</label>
            <textarea class="form-control" id="returnOtherReason" rows="2"></textarea>
          </div>
          <div class="mb-3">
            <label for="returnComments" class="form-label">Additional comments</label>
            <textarea class="form-control" id="returnComments" rows="3"></textarea>
          </div>
          <div class="alert alert-info">
            <p class="mb-0">Please note: Return requests must be made with in the 5 days  of delivery.</p>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" onclick="confirmReturnOrder()">Submit Return Request</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Review Order Modal -->
  <div class="modal fade" id="reviewOrderModal" tabindex="-1" aria-labelledby="reviewOrderModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="reviewOrderModalLabel">Rate & Review</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="text-center mb-4">
            <h6>How would you rate this product?</h6>
            <div class="rating-stars mb-2" id="ratingStars">
              <span data-value="5">☆</span>
              <span data-value="4">☆</span>
              <span data-value="3">☆</span>
              <span data-value="2">☆</span>
              <span data-value="1">☆</span>
            </div>
            <small class="text-muted" id="ratingText">Tap to rate</small>
          </div>
          <div class="mb-3">
            <label for="reviewTitle" class="form-label">Review Title</label>
            <input type="text" class="form-control" id="reviewTitle" placeholder="Summarize your experience">
          </div>
          <div class="mb-3">
            <label for="reviewText" class="form-label">Your Review</label>
            <textarea class="form-control" id="reviewText" rows="4" placeholder="Share details about your experience with this product"></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" onclick="submitReview()">Submit Review</button>
        </div>
      </div>
    </div>
  </div>

  <!-- View Review Modal -->
  <div class="modal fade" id="viewReviewModal" tabindex="-1" aria-labelledby="viewReviewModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="viewReviewModalLabel">Your Review</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="text-center mb-4">
            <div class="rating-stars mb-2"></div>
            <h5 id="reviewTitleDisplay"></h5>
          </div>
          <div class="mb-3">
            <p id="reviewTextDisplay"></p>
          </div>
          <div class="text-muted small" id="reviewDateDisplay"></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

   <!-- JavaScript -->
  <script>
    function showSection(sectionId) {
      const sections = document.querySelectorAll('.section');
      sections.forEach(section => {
        section.classList.remove('fade-in');
        section.style.display = 'none';
      });
      const activeSection = document.getElementById(sectionId);
      if (activeSection) {
        activeSection.style.display = 'block';
        setTimeout(() => {
          activeSection.classList.add('fade-in');
        }, 10); // Delay to allow display change to take effect
      }
    }
 // Simple hash function for password hashing (for demonstration purposes)
    function simpleHash(password) {
      let hash = 0;
      for (let i = 0; i < password.length; i++) {
        hash = (hash << 5) - hash + password.charCodeAt(i);
        hash |= 0; // Convert to 32-bit integer
      }
      return hash;
    }

// Global variables
let users = [];
let cart = [];
let orders = [];
let notifications = [];
let ownerNotifications = [];
let currentUser = null;
let currentProductForPurchase = null;
let currentOrderIndex = null;
let activeFilters = {};
let menswearActiveFilters = {};
let accessoriesActiveFilters = {};
let recentSearches = [];
let validCoupons = [];
let searchTimeout = null;
let currentOrdersFilter = 'all';

const locations = ["New York", "Los Angeles", "Chicago", "Houston", "Phoenix"];
const colorMap = { "Blue": "#0000FF", "Red": "#FF0000", "Black": "#000000", "Brown": "#8B4513", "White": "#FFFFFF" };
let currentOrderIndexForMessage = null;
let shopSearchTimeout = null;


// Function to generate a random 8-character coupon code
function generateCouponCode() {
  const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
  let code = '';
  for (let i = 0; i < 8; i++) {
    code += characters.charAt(Math.floor(Math.random() * characters.length));
  }
  return code;
}

// Update saveData to include validCoupons
function saveData() {
  localStorage.setItem("users", JSON.stringify(users));
  localStorage.setItem("cart", JSON.stringify(cart));
  localStorage.setItem("orders", JSON.stringify(orders));
  localStorage.setItem("notifications", JSON.stringify(notifications));
  localStorage.setItem("ownerNotifications", JSON.stringify(ownerNotifications));
  localStorage.setItem("currentUser", JSON.stringify(currentUser));
  localStorage.setItem("validCoupons", JSON.stringify(validCoupons));
}

// Update loadData to load validCoupons
function loadData() {
  users = JSON.parse(localStorage.getItem("users")) || [];
  cart = JSON.parse(localStorage.getItem("cart")) || [];
  orders = JSON.parse(localStorage.getItem("orders")) || [];
  notifications = JSON.parse(localStorage.getItem("notifications")) || [];
  ownerNotifications = JSON.parse(localStorage.getItem("ownerNotifications")) || [];
  currentUser = JSON.parse(localStorage.getItem("currentUser"));
  validCoupons = JSON.parse(localStorage.getItem("validCoupons")) || [];
  if (currentUser && currentUser.isLoggedIn) {
    const user = users.find(u => u.email === currentUser.email);
    if (user) {
      currentUser = { ...user, isLoggedIn: true, lastActivity: new Date().toISOString() };
    } else {
      currentUser = null;
    }
  } else {
    currentUser = null;
  }
  updateHeaderProfile();
  updateMenuAccountDetails();
  updateCartCountBadge();
  generateProducts("shopProductContainer", products);  
}
function setCurrentOrderIndex(index) {
  currentOrderIndexForMessage = index;
}

function confirmSendMessage() {
  const message = document.getElementById("messageText").value.trim();
  if (!message) {
    showNotification("Please enter a message.", "warning");
    return;
  }
  const order = orders[currentOrderIndexForMessage];
  const user = users.find(u => u.email === order.buyer.email);
  if (user) {
    if (!user.notifications) user.notifications = [];
    user.notifications.push({
      message: `Message from Owner: ${message}`,
      type: "info",
      title: "Message from Owner",
      date: new Date().toLocaleString()
    });
    showNotification(`Message sent to user: ${user.firstName} ${user.lastName}`, "success");
    saveData();
    const modal = bootstrap.Modal.getInstance(document.getElementById("sendMessageModal"));
    modal.hide();
    document.getElementById("messageText").value = "";
  } else {
    showNotification("User not found.", "warning");
  }
}
const products = [
  {
    id: 1,
    name: "Men-Black/Jordan Oversized T-Shirt",
    description: "Comfortable and stylish men's t-shirt.",
    category: "T-Shirts",
    price: 429.99,
    discount: 38, // 10% discount set by owner
    size: "L",
    color: "Black",
    clothType: "100% Cotton",
    deliveryTime: "3-5 days",
    returnPolicy: "5 days return policy",
    additionalDetails: "Machine washable, soft and breathable fabric.",
    images: [
      "https://i.pinimg.com/736x/99/df/c6/99dfc6172b5df9a97c22d2af93aac789.jpg",
       "https://i.pinimg.com/736x/71/ed/b3/71edb347dbbcc9f5708fb2e141b4e6c9.jpg",
      "https://i.pinimg.com/736x/5e/06/2f/5e062fb9641aeb3558304ee1bb93a1d5.jpg",
    ],
    colorImages: {
      "Black": "https://i.pinimg.com/736x/99/df/c6/99dfc6172b5df9a97c22d2af93aac789.jpg"
    },
    specifications: {
       "Material": "100% Cotton",
      "Fit": "Oversized",
      "Sleeve": "Short",
      "Neck": "Round Neck"
    }
  },
{
  id: 2,
  name: "Nxew's Men Oversized T-Shirt",
  description: "Comfortable and stylish men's T-shirt.",
  category: "T-Shirts",
  price: 349,
  discount: 36,
  size: "L",
  color: "Black",
  clothType: "100% Cotton",
  deliveryTime: "3-5 days",
  returnPolicy: "5 days return policy",
  additionalDetails: "Machine washable and weather proof.",
  images: [
    "https://i.pinimg.com/736x/78/3e/39/783e39cca642ba73cd5455ce8be39608.jpg",
    "https://i.pinimg.com/736x/a8/03/b7/a803b71b74c0b3c7f70938556d480111.jpg",
    "https://i.pinimg.com/736x/26/94/be/2694be21bc82399c67208bf6d65068a4.jpg",
    "https://i.pinimg.com/736x/37/a7/e2/37a7e22ccccb2fd9e158db92d9fe094d.jpg",
    "https://i.pinimg.com/736x/ae/36/14/ae36149467f17d37a86ab84051b321f7.jpg"
  ],
  colorImages: {
    "Black": "https://i.pinimg.com/736x/78/3e/39/783e39cca642ba73cd5455ce8be39608.jpg"
  },
  specifications: {
    "Material": "100% Cotton",
    "Fit": "Oversized",
    "Sleeve": "Short",
    "Neck": "Round Neck"
  }
},
  {
    id: 3,
    name: "Alien Men-Oversized T-Shirt",
    description: "Comfortable and stylish T-shirt.",
    category: "T-Shirts",
    price: 349,
    discount: 26, // 20% discount set by owner
    size: "L",
    color: " Black",
    clothType: "Cotton",
    deliveryTime: "3-5 days",
    returnPolicy: "5 days return policy",
  additionalDetails: "Machine washable and weather proof. This product is sold out.", // Updated
    images: [
      "https://i.pinimg.com/736x/22/3e/6e/223e6ec6ab0a025177a6502a10d4cceb.jpg",
      "https://i.pinimg.com/736x/1f/f9/3e/1ff93ece8aa88d219e7f653815af9968.jpg",
      "https://i.pinimg.com/736x/0a/71/e1/0a71e1b76821af8f9ef8ceb1d843a1b7.jpg",
      "https://i.pinimg.com/736x/ad/35/e2/ad35e2b64522a040c6fc3d0c64e8c09f.jpg"
    ],
    colorImages: {
      "Black": "https://i.pinimg.com/736x/22/3e/6e/223e6ec6ab0a025177a6502a10d4cceb.jpg"
    },
    specifications: {
      "Material": "100% Cotton",
      "Fit": "Oversized",
      "Sleeve": "Short",
      "Neck": "Round Neck"
    }
  },
  {
    id: 4,
    name: "Nxew's white-Sweat T-Shirt",
    description: "Stylish and comfortable to wear.",
    category: "sweat T-Shirts",
    price: 449.99,
    discount: 32, // 15% discount set by owner
    size: " XL, XXL",
    color: "white",
    clothType: "100% cotton",
    deliveryTime: "3-5 days",
    returnPolicy: "5 days return policy",
    additionalDetails: "High-quality cotton , perfect for winter.",
    images: [
      "https://i.pinimg.com/736x/f1/4f/81/f14f81d82a4cc1f45abc6f0a9f5deffe.jpg",
      "https://i.pinimg.com/736x/67/45/86/674586f94e1db394448a9ab0257cc729.jpg",
    ],
    colorImages: {
      "white": "https://i.pinimg.com/736x/f1/4f/81/f14f81d82a4cc1f45abc6f0a9f5deffe.jpg",

    },
    specifications: {
      "Material": "100% cotton",
      "Fit": "Slim Fit",
      "Sleeve": "Long Sleeve",
      "Neck": "Collareless"
    }
  },
  {
    id: 5,
    name: "Nxew's Black  Sweat T-Shirt",
    description: "Weather proof.",
    category: "sweat T-Shirts",
    price: 499.99,
    discount: 37, // 12% discount set by owner
    size: " XXL",
    color: "Black ",
    clothType: "100% Cotton ",
    deliveryTime: "3-5 days",
    returnPolicy: "5 days return policy",
    additionalDetails: "Breathable fabric,Comfortable to wear.",
    images: [
          "https://i.pinimg.com/736x/a8/28/16/a82816b8a65b325163dd0271d08780c4.jpg",
      "https://i.pinimg.com/736x/a7/00/04/a70004de24160bca35a5ce2a16012957.jpg",
    ],
    colorImages: {
      "Black": "https://i.pinimg.com/736x/68/41/79/684179f8e602a855fc3a87695ed47d76.jpg",
    },
    specifications: {
      "Material": "100% cotton",
      "Fit": "Regular Fit",
      "Sleeve": "Long Sleeve",
      "Neck": "Collarless"
    }
  },
 {
  id: 6,
  name: "Nxew's Half sleeve Shirt",
  description: "RELAXED FIT EMBROIDERED SHIRT",
  category: "Half sleeve Shirts",
  price: 349.99,
  discount: 20,
  size: "L",
  color: "Blue",
  clothType: "Cotton Viscose",
  deliveryTime: "3-5 days",
  returnPolicy: "5 days return policy",
  additionalDetails: "Stylish and comfortable, perfect for casual outings. This product is sold out.",
  images: [
    "https://i.pinimg.com/736x/ca/d0/dd/cad0dd3c7f3880dee714da8bdecdf723.jpg",
    "https://i.pinimg.com/736x/13/1d/aa/131daac4414ce7338ccdd6941ad7d130.jpg"
  ],
  colorImages: {
    "Blue": "https://i.pinimg.com/736x/ca/d0/dd/cad0dd3c7f3880dee714da8bdecdf723.jpg"
  },
  specifications: {
    "Material": "Cotton Viscose",
    "Fit": "Relaxed Fit",
    "Sleeve": "Half Sleeves",
    "Neck": "Cuban Collar"
  }
},
  {
    id: 7,
    name: "Half sleeve Acid wash T-Shirt",
    description: "RELAXED FIT EMBROIDERED T-SHIRT",
    category: "T-Shirts",
    price: 249.99,
    discount: 24, // 15% discount set by owner
    size: "L",
    color: "BLue",
    clothType: "Cotton",
    deliveryTime: "3-5 days",
    returnPolicy: "5 days return policy",
    additionalDetails: "Men's Blue Hustle Typography Oversized Acid Wash T-shirt",
    images: [
      "https://i.pinimg.com/736x/8b/0b/21/8b0b21072e783ba7534c8975519f2d85.jpg",
      "https://i.pinimg.com/736x/81/91/62/81916265cf66a6079ff353528add0773.jpg",
      "https://i.pinimg.com/736x/03/ab/0c/03ab0c096a7b92e5609cd7b72ec585f6.jpg"
    ],
    colorImages: {
      "Blue": "https://i.pinimg.com/736x/8b/0b/21/8b0b21072e783ba7534c8975519f2d85.jpg"
    },
    specifications: {
      "Material": "Cotton",
      "Fit": "Relaxed Fit",
      "Sleeve": "Half Sleeves",
      "Neck": "Round Neck",
      "Cloth Type": "100% Cotton"
    }
  },
  {
    id: 8,
    name: "Formal Shirt",
    description: "",
    category: "Shirts",
    price: 449.99,
    discount: 25, // 15% discount set by owner
    size: "L",
    color: "Gray",
    clothType: "Cotton cum Polyester",
    deliveryTime: "3-5 days",
    returnPolicy: "5 days return policy",
    additionalDetails: "Men's Gray Hustle Formal shirt.This product is sold out.",
    images: [
      "https://i.pinimg.com/736x/79/b9/30/79b9303c53a85ef2d2d6928836823672.jpg",
      "https://i.pinimg.com/736x/8e/7c/0e/8e7c0ef2dbf1c52b6f9bae8a9dcfbae4.jpg",
      "https://i.pinimg.com/736x/ee/a9/62/eea96278d28fdfa1157f6347fc08a466.jpg"
    ],
    colorImages: {
      "Gray": "https://i.pinimg.com/736x/79/b9/30/79b9303c53a85ef2d2d6928836823672.jpg"
    },
    specifications: {
      "Material": "Cotton cum Polyester",
      "Sleeve": "full Sleeves",
      "collar": " Spread Collar",
      "Occasion:": "Formal",
      "Pattern": "Solid",
    }
  },
];
// Save data to localStorage
function saveData() {
  localStorage.setItem("users", JSON.stringify(users));
  localStorage.setItem("cart", JSON.stringify(cart));
  localStorage.setItem("orders", JSON.stringify(orders));
  localStorage.setItem("notifications", JSON.stringify(notifications));
  localStorage.setItem("ownerNotifications", JSON.stringify(ownerNotifications));
  localStorage.setItem("currentUser", JSON.stringify(currentUser));
}

// Load data from localStorage
function loadData() {
  users = JSON.parse(localStorage.getItem("users")) || [];
  cart = JSON.parse(localStorage.getItem("cart")) || [];
  orders = JSON.parse(localStorage.getItem("orders")) || [];
  notifications = JSON.parse(localStorage.getItem("notifications")) || [];
  ownerNotifications = JSON.parse(localStorage.getItem("ownerNotifications")) || [];
  currentUser = JSON.parse(localStorage.getItem("currentUser"));
  if (currentUser && currentUser.isLoggedIn) {
    const user = users.find(u => u.email === currentUser.email);
    if (user) {
      currentUser = { ...user, isLoggedIn: true, lastActivity: new Date().toISOString() };
    } else {
      currentUser = null;
    }
  } else {
    currentUser = null;
  }
  updateHeaderProfile();
  updateMenuAccountDetails();
  updateCartCountBadge();
  generateProducts("shopProductContainer", products);
  generateProducts("menswearContainer", products.filter(p => p.category === "Men's Wear"));
  generateProducts("accessoriesContainer", products.filter(p => p.category === "Accessories"));
  generateProducts("featuredProductsContainer", products.slice(0, 20));
}

// Show notification function
function showNotification(message, type = "success", options = {}) {
  const { title = type.charAt(0).toUpperCase() + type.slice(1), duration = 3000, persist = false } = options;
  const toastEl = document.createElement("div");
  toastEl.className = `toast text-white bg-${type} border-0`;
  toastEl.setAttribute("role", "alert");
  toastEl.setAttribute("aria-live", "polite");
  toastEl.setAttribute("aria-atomic", "true");
  toastEl.setAttribute("aria-label", `${title} notification`);

  const icons = {
    success: "bi-check-circle-fill",
    danger: "bi-exclamation-triangle-fill",
    warning: "bi-exclamation-circle-fill",
    info: "bi-info-circle-fill",
  };
  const iconClass = icons[type] || "bi-bell-fill";

  toastEl.innerHTML = `
    <div class="toast-header">
      <i class="bi ${iconClass} notification-icon"></i>
      <strong class="toast-title">${title}</strong>
      <small>${new Date().toLocaleTimeString()}</small>
      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
    <div class="toast-body">
      ${message}
    </div>
  `;

  document.getElementById("toastContainer").appendChild(toastEl);
  const toastOptions = persist ? { autohide: false } : { delay: duration };
  const toast = new bootstrap.Toast(toastEl, toastOptions);
  toast.show();

  toastEl.addEventListener("hidden.bs.toast", () => toastEl.remove());

  notifications.push({ message, type, title, date: new Date().toLocaleString() });
  saveData();
}

// Show popup message
function showPopupMessage(message) {
  document.getElementById("popupMessageContent").innerHTML = message;
  const popupModal = new bootstrap.Modal(document.getElementById("popupMessageModal"));
  popupModal.show();
}
// Update user activity
function updateUserActivity() {
  if (currentUser) {
    currentUser.lastActivity = new Date().toISOString();
    const userIndex = users.findIndex(u => u.email === currentUser.email);
    if (userIndex !== -1) users[userIndex].lastActivity = currentUser.lastActivity;
    saveData();
  }
}
// Get active users (last 5 minutes)
function getActiveUsers() {
  const now = new Date();
  const fiveMinutesAgo = new Date(now - 5 * 60 * 1000);
  return users.filter(user => new Date(user.lastActivity) > fiveMinutesAgo).length;
}

// Get live users (last 1 minute)
function getLiveUsers() {
  const now = new Date();
  const oneMinuteAgo = new Date(now - 1 * 60 * 1000);
  return users.filter(user => new Date(user.lastActivity) > oneMinuteAgo).length;
}

// Update header profile
function updateHeaderProfile() {
  const headerProfile = document.getElementById('headerProfile');
  if (currentUser) {
    headerProfile.innerHTML = `<i class="bi bi-person-circle"></i> ${currentUser.firstName} ${currentUser.lastName}`;
  } else {
    headerProfile.innerHTML = `<i class="bi bi-person-circle"></i> Guest`;
  }
}

// Hide menu
function hideMenu() {
  const menuCanvas = bootstrap.Offcanvas.getInstance(document.getElementById("menuCanvas"));
  if (menuCanvas) menuCanvas.hide();
}

function getProductRating(productId) {
  const productOrders = orders.filter(order => order.product.id === productId && order.rating !== null);
  if (productOrders.length === 0) {
    return null;
  }
  const totalRating = productOrders.reduce((sum, order) => sum + order.rating, 0);
  const averageRating = totalRating / productOrders.length;
  return { average: averageRating.toFixed(1), count: productOrders.length };
}

// Toggle search bar visibility
function toggleSearchBar() {
  const searchBarContainer = document.getElementById("searchBarContainer");
  if (searchBarContainer.style.display === "none" || searchBarContainer.style.display === "") {
    searchBarContainer.style.display = "flex";
    document.getElementById("searchSectionInput").focus();
    performSearch();
  } else {
    searchBarContainer.style.display = "none";
  }
}

// Handle search input with debounce
function handleSearchInput() {
  clearTimeout(searchTimeout);
  searchTimeout = setTimeout(() => {
    performSearch();
    showSearchSuggestions();
  }, 300); // 300ms debounce delay
}

// Show search suggestions
function showSearchSuggestions() {
  const input = document.getElementById("searchSectionInput").value.toLowerCase();
  const suggestionsContainer = document.getElementById("searchSuggestions");

  if (input.length < 2) {
    suggestionsContainer.style.display = "none";
    return;
  }

  const suggestions = products.filter(product =>
    product.name.toLowerCase().includes(input) ||
    product.description.toLowerCase().includes(input) ||
    product.category.toLowerCase().includes(input)
  ).slice(0, 5);

  if (suggestions.length === 0) {
    suggestionsContainer.style.display = "none";
    return;
  }

  let html = '';
  suggestions.forEach(product => {
    html += `
      <div class="search-suggestion-item" onclick="document.getElementById('searchSectionInput').value='${product.name}'; performSearch(); document.getElementById('searchSuggestions').style.display='none';">
        ${product.name} - ${product.category}
      </div>
    `;
  });

  suggestionsContainer.innerHTML = html;
  suggestionsContainer.style.display = "block";
}

// Perform search with all filters activated
function performSearch() {
  const query = document.getElementById("searchSectionInput").value.toLowerCase();
  const category = document.getElementById("searchCategory").value;
  const priceRange = document.getElementById("searchPrice").value;
  const minRating = document.getElementById("searchRating").value;
  const sortBy = document.getElementById("searchSort").value;
  const size = document.getElementById("searchSize").value;
  const color = document.getElementById("searchColor").value;

  let filteredProducts = [...products];

  if (query) {
    filteredProducts = filteredProducts.filter(p =>
      p.name.toLowerCase().includes(query) ||
      p.description.toLowerCase().includes(query) ||
      p.category.toLowerCase().includes(query)
    );
  }

  if (category) {
    filteredProducts = filteredProducts.filter(p => p.category === category);
  }

  if (priceRange) {
    const [min, max] = priceRange.split("-").map(Number);
    filteredProducts = filteredProducts.filter(p => {
      if (max) return p.price >= min && p.price <= max;
      return p.price >= min;
    });
  }

  if (minRating) {
    filteredProducts = filteredProducts.filter(p => {
      const ratingInfo = getProductRating(p.id);
      return ratingInfo && ratingInfo.average >= parseInt(minRating);
    });
  }

  if (size) {
    filteredProducts = filteredProducts.filter(p =>
      p.size.split(",").map(s => s.trim().toLowerCase()).includes(size.toLowerCase())
    );
  }

  if (color) {
    filteredProducts = filteredProducts.filter(p =>
      p.color.split(",").map(c => c.trim().toLowerCase()).includes(color.toLowerCase())
    );
  }

  switch (sortBy) {
    case "price-low":
      filteredProducts.sort((a, b) => a.price - b.price);
      break;
    case "price-high":
      filteredProducts.sort((a, b) => b.price - a.price);
      break;
    case "rating":
      filteredProducts.sort((a, b) => {
        const ratingA = getProductRating(a.id)?.average || 0;
        const ratingB = getProductRating(b.id)?.average || 0;
        return ratingB - ratingA;
      });
      break;
    case "newest":
      filteredProducts.sort((a, b) => b.id - a.id);
      break;
    default:
      if (query) {
        filteredProducts.sort((a, b) => {
          const aMatches = a.name.toLowerCase().includes(query) ? 1 : 0;
          const bMatches = b.name.toLowerCase().includes(query) ? 1 : 0;
          return bMatches - aMatches;
        });
      }
  }

  displaySearchResults(filteredProducts);
  updateSearchActiveFilters(query, category, priceRange, minRating, size, color, sortBy);
}
// Display search results
function displaySearchResults(results) {
  const container = document.getElementById("searchResultsContainer");
  const countElement = document.getElementById("searchResultsCount");
  
  countElement.textContent = `${results.length} products found`;
  
  if (results.length === 0) {
    container.innerHTML = "<p>No products found.</p>";
    return;
  }
  
  container.innerHTML = "";
  results.forEach(product => {
    const discount = product.discount || 0;
    const originalPrice = discount > 0 ? (product.price / (1 - discount / 100)).toFixed(2) : product.price.toFixed(2);
    const isSoldOut = product.additionalDetails.toLowerCase().includes("sold out"); // Check for sold out
    
    const card = `
      <div class="col-6 mb-4">
        <div class="card shadow-sm product-card" style="position: relative;" onclick="showProductDetails(${product.id})">
          <img src="${product.images && product.images.length ? product.images[0] : 'https://via.placeholder.com/400x300?text=' + encodeURIComponent(product.name)}" 
               class="card-img-top" alt="${product.name}">
          ${discount > 0 ? `<span class="badge bg-danger position-absolute top-0 start-0 m-2">${discount}% OFF</span>` : ''}
          ${isSoldOut ? `<span class="badge bg-dark position-absolute top-0 end-0 m-2">Sold Out</span>` : `
          `}
          <div class="card-body">
            <h5 class="card-title">${product.name}</h5>
            <p class="card-text">${product.description}</p>
            <p class="card-text">
              <span class="fw-bold">₹${product.price.toFixed(2)}</span>
              ${discount > 0 ? `<small class="text-decoration-line-through text-muted ms-1">₹${originalPrice}</small>` : ''}
            </p>
          </div>
        </div>
      </div>
    `;
    container.innerHTML += card;
  });
}
// Voice search functionality
function startVoiceSearch() {
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  if (!SpeechRecognition) {
    showNotification("Voice search is not supported in your browser.", "warning");
    return;
  }

  const recognition = new SpeechRecognition();
  const voiceSearchBtn = document.getElementById("voiceSearchButton");

  recognition.continuous = false;
  recognition.interimResults = false;
  recognition.lang = "en-US";

  recognition.onstart = function() {
    voiceSearchBtn.classList.add("active");
    showNotification("Listening... Please speak clearly.", "info", { duration: 2000 });
  };

  recognition.onresult = function(event) {
    const results = event.results[0];
    let transcript = results[0].transcript.trim().toLowerCase();
    transcript = cleanTranscript(transcript);

    document.getElementById("searchSectionInput").value = transcript;
    toggleSearchBar();
    addToSearchHistory(transcript);
    performSearch();
    showNotification(`Searching for: "${transcript}"`, "success");

    resetVoiceSearchButton();
  };

  recognition.onerror = function(event) {
    resetVoiceSearchButton();
    let errorMessage = "An error occurred during voice search.";
    switch (event.error) {
      case "no-speech":
        errorMessage = "No speech detected. Please try again.";
        break;
      case "not-allowed":
      case "service-not-allowed":
        errorMessage = "Microphone access denied. Please enable it in your browser settings.";
        break;
      case "audio-capture":
        errorMessage = "No microphone detected. Please ensure one is connected.";
        break;
      default:
        errorMessage = `Voice search error: ${event.error}`;
    }
    showNotification(errorMessage, "danger");
  };

  recognition.onend = function() {
    resetVoiceSearchButton();
    showNotification("Voice search completed.", "info", { duration: 1500 });
  };

  try {
    recognition.start();
  } catch (e) {
    resetVoiceSearchButton();
    showNotification("Failed to start voice search. Please try again.", "danger");
  }
}

// Helper function to clean up the transcript
function cleanTranscript(transcript) {
  const fillers = ["um", "uh", "like", "you know"];
  let cleaned = transcript.split(" ").filter(word => !fillers.includes(word)).join(" ");

  const corrections = {
    "t shirt": "t-shirt",
    "jeans": "denim jeans",
    "sun glasses": "sunglasses",
    "watch": "wrist watch",
    "accessory": "accessories",
  };
  Object.keys(corrections).forEach(mistake => {
    if (cleaned.includes(mistake)) {
      cleaned = cleaned.replace(mistake, corrections[mistake]);
    }
  });

  return cleaned;
}

// Helper function to reset the voice search button
function resetVoiceSearchButton() {
  const voiceSearchBtn = document.getElementById("voiceSearchButton");
  voiceSearchBtn.classList.remove("active");
  voiceSearchBtn.innerHTML = '<i class="bi bi-mic"></i>';
}

// Generate products function with support for different layouts
function generateProducts(containerId, productList) {
  const container = document.getElementById(containerId);
  
  if (!container) return; // Exit if container not found
  
  // Update results count if applicable
  const countElement = document.getElementById(`${containerId.replace("Container", "")}ResultsCount`);
  if (countElement) {
    const query = document.getElementById("searchInput")?.value.trim();
    countElement.textContent = query ? 
      `${productList.length} products found` : 
      "All products";
  }

  // Handle empty product list
  if (productList.length === 0) {
    container.innerHTML = `
      <div class="col-12 text-center py-5">
        <i class="bi bi-search" style="font-size: 3rem; color: #ccc;"></i>
        <h4 class="mt-3">No products found</h4>
        <p>Try adjusting your search</p>
      </div>
    `;
    return;
  }

  container.innerHTML = "";
}
 // Generate products function with fixed discount
function generateProducts(containerId, productList, showDiscount = true) {
  const container = document.getElementById(containerId);
  
  if (!container) return;

  // Update results count if applicable (unchanged)
  if (containerId !== "featuredProductsContainer") {
    const countElement = document.getElementById(`${containerId.replace("Container", "")}ResultsCount`);
    if (countElement) {
      const query = document.getElementById("searchInput")?.value.trim();
      countElement.textContent = query ? 
        `${productList.length} products found` : 
        "All products";
    }
  }

  // Handle empty product list (unchanged)
  if (productList.length === 0) {
    container.innerHTML = `
      <div class="col-12 text-center py-5">
        <i class="bi bi-search" style="font-size: 3rem; color: #ccc;"></i>
        <h4 class="mt-3">No products found</h4>
        <p>Try adjusting your search</p>
      </div>
    `;
    return;
  }

  container.innerHTML = "";
  
  productList.forEach(product => {
    const discount = product.discount || 0;
    const originalPrice = discount > 0 ? (product.price / (1 - discount / 100)).toFixed(2) : product.price.toFixed(2);
    const ratingInfo = getProductRating(product.id);    
    if (containerId === "featuredProductsContainer") {
      const card = `
        <div class="col-6 col-md-4 col-lg-3 mb-4">
          <div class="card shadow-sm product-card" onclick="showProductDetails(${product.id})">
            <div style="position: relative;">
              <img src="${product.images && product.images.length ? product.images[0] : 'https://via.placeholder.com/400x300?text=' + encodeURIComponent(product.name)}" 
                   class="card-img-top" alt="${product.name}" style="height: 200px; object-fit: cover;">
              ${showDiscount && discount > 0 ? `<span class="badge bg-danger position-absolute top-0 start-0 m-2">${discount}% OFF</span>` : ''}
              </button>
            </div>
            <div class="card-body">
              <h5 class="card-title">${product.name}</h5>
              <p class="card-text text-muted" style="font-size: 0.9rem;">${product.description}</p>
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <span class="fw-bold">₹${product.price.toFixed(2)}</span>
                  ${showDiscount && discount > 0 ? `<small class="text-decoration-line-through text-muted ms-1">₹${originalPrice}</small>` : ''}
                </div>
                ${ratingInfo ? `
                  <div class="d-flex align-items-center">
                    <i class="bi bi-star-fill text-warning me-1"></i>
                    <small>${ratingInfo.average}</small>
                  </div>
                ` : ''}
              </div>
            </div>
          </div>
        </div>
      `;
      container.innerHTML += card;
    } else {
      const card = `
        <div class="col-6 mb-4">
          <div class="card shadow-sm product-card" style="position: relative;" onclick="showProductDetails(${product.id})">
            <img src="${product.images && product.images.length ? product.images[0] : 'https://via.placeholder.com/400x300?text=' + encodeURIComponent(product.name)}" 
                 class="card-img-top" alt="${product.name}">
            ${showDiscount && discount > 0 ? `<span class="badge bg-danger position-absolute top-0 start-0 m-2">${discount}% OFF</span>` : ''}
            <div class="card-body">
              <h5 class="card-title">${product.name}</h5>
              <p class="card-text">${product.description}</p>
              <p class="card-text">
                <span class="fw-bold">₹${product.price.toFixed(2)}</span>
                ${showDiscount && discount > 0 ? `<small class="text-decoration-line-through text-muted ms-1">₹${originalPrice}</small>` : ''}
              </p>
              ${ratingInfo ? `
                <p class="card-text">
                  <i class="bi bi-star-fill text-warning"></i> 
                  ${ratingInfo.average} (${ratingInfo.count} reviews)
                </p>
              ` : ''}
            </div>
          </div>
        </div>
      `;
      container.innerHTML += card;
    }
  });
}
// Get recommended products
function getRecommendedProducts(currentProductId) {
  const currentProduct = products.find(p => p.id === currentProductId);
  if (!currentProduct) return [];

  let recommendations = products.filter(p =>
    p.category === currentProduct.category &&
    p.id !== currentProductId
  );

  if (recommendations.length < 20) {
    const otherProducts = products.filter(p =>
      p.category !== currentProduct.category &&
      p.id !== currentProductId
    );
    recommendations = [...recommendations, ...otherProducts.slice(0, 20 - recommendations.length)];
  }

  return recommendations.slice(0, 20);
}

// Generate recommended products with fixed discount
function generateRecommendedProducts(recommendations) {
  if (recommendations.length === 0) return '';

  let html = `
    <div class="recommendations-section">
      <h3 class="recommendations-title">You May Also Like</h3>
      <div class="row">
  `;

  recommendations.forEach(product => {
    const discount = product.discount || 0;
    const originalPrice = discount > 0 ? (product.price / (1 - discount / 100)).toFixed(2) : product.price.toFixed(2);
    const discountedPrice = product.price.toFixed(2);

    html += `
      <div class="col-6 col-md-3">
        <div class="card recommendation-card" onclick="showProductDetails(${product.id})">
          <img src="${product.images && product.images.length ? product.images[0] : 'https://via.placeholder.com/400x300?text=' + encodeURIComponent(product.name)}"
               class="card-img-top recommendation-img" alt="${product.name}">
          ${discount > 0 ? `<span class="recommendation-badge">${discount}% OFF</span>` : ''}
          <div class="card-body">
            <h5 class="card-title">${product.name}</h5>
            <p class="card-text">
              <span class="fw-bold">₹${discountedPrice}</span>
              ${discount > 0 ? `<small class="text-decoration-line-through text-muted ms-1">₹${originalPrice}</small>` : ''}
            </p>
          </div>
        </div>
      </div>
    `;
  });

  html += `
      </div>
    </div>
  `;

  return html;
}
// Show product details with fixed discount
function showProductDetails(productId) {
  const product = products.find(p => p.id === productId);
  if (!product) return;

  const sizes = product.size.split(",").map(s => s.trim());
  const colors = product.color.split(",").map(c => c.trim());
  const defaultColor = colors[0];
  const discount = product.discount || 0;
  const originalPrice = discount > 0 ? (product.price / (1 - discount / 100)).toFixed(2) : product.price.toFixed(2);
  const ratingInfo = getProductRating(productId);

  // Generate carousel HTML for scrollable images
  let carouselHtml = `
    <div id="productCarousel" class="carousel slide carousel-fade" data-bs-ride="carousel">
      <div class="carousel-inner">
  `;
  product.images.forEach((img, index) => {
    carouselHtml += `
      <div class="carousel-item ${index === 0 ? 'active' : ''}">
        <img src="${img}" class="d-block w-100 product-detail-img" alt="${product.name}">
      </div>
    `;
  });
  carouselHtml += `
      </div>
      <button class="carousel-control-prev" type="button" data-bs-target="#productCarousel" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
      </button>
      <button class="carousel-control-next" type="button" data-bs-target="#productCarousel" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
      </button>
    </div>
  `;

  // Generate color thumbnails
  let colorThumbnails = colors.map(color => {
    const imageUrl = product.colorImages[color] || product.images[0];
    return `
      <div class="color-thumbnail ${color === defaultColor ? 'selected' : ''}" 
           data-color="${color}" onclick="selectColor('${color}')">
        <img src="${imageUrl}" alt="${color}" style="width: 50px; height: 50px;" />
      </div>
    `;
  }).join("");

  // Generate size buttons
  let sizeButtons = sizes.map(size => `
    <button type="button" class="btn btn-outline-secondary size-btn ${size === sizes[0] ? 'active' : ''}" 
            data-size="${size}" onclick="selectSize('${size}')">${size}</button>
  `).join("");

  // Specifications table
  const specifications = product.specifications || {
    "Material": product.clothType,
    "Fit": "Regular",
    "Sleeve": "N/A",
    "Neck": "N/A"
  };
  const specTable = Object.entries(specifications).map(([key, value]) => `
    <tr><td>${key}</td><td>${value}</td></tr>
  `).join("");

  // Recommended products
  const recommendations = getRecommendedProducts(productId);
  const recommendationsHTML = generateRecommendedProducts(recommendations);

  // Full product detail content
  const detailContent = `
    <div class="container">
      <div class="row">
        <div class="col-md-6">
          ${carouselHtml}
          <div class="color-selection mt-3 d-flex flex-wrap gap-2">
            ${colorThumbnails}
          </div>
        </div>
        <div class="col-md-6">
          <h2 class="mb-3">${product.name}</h2>
          <div class="ratings mb-2">
            ${ratingInfo ? `
              <span class="badge bg-success me-2">
                <i class="bi bi-star-fill text-white"></i> ${ratingInfo.average}
              </span>
              <span class="text-muted">(${ratingInfo.count} ratings)</span>
            ` : '<span class="text-muted">No ratings yet</span>'}
          </div>
          <div class="price mb-3">
            <span class="current-price" style="font-size: 1.8rem; color: #e74c3c;">
              ₹${product.price.toFixed(2)}
            </span>
            ${discount > 0 ? `
              <span class="original-price text-muted ms-2" style="text-decoration: line-through;">
                ₹${originalPrice}
              </span>
              <span class="discount badge bg-success ms-2">${discount}% off</span>
            ` : ''}
          </div>
          <div class="mb-3">
            <label class="form-label"><strong>Size:</strong></label><br>
            <div class="d-flex flex-wrap gap-2">
              ${sizeButtons}
            </div>
          </div>
          <div class="actions mb-4 d-flex gap-2">
            <button class="btn btn-primary flex-grow-1" 
                    onclick="addToCartWithSelection(${product.id})">
              <i class="bi bi-cart-plus me-1"></i> Add to Bag
            </button>
            <button class="btn btn-success flex-grow-1" 
                    onclick="buyProductWithSelection(${product.id})">
              <i class="bi bi-lightning-charge me-1"></i> Buy Now
            </button>
          </div>
          <div class="description mb-4">
            <h4 class="mb-2">Description</h4>
            <p>${product.description} ${product.additionalDetails}</p>
          </div>
          <div class="specifications mb-4">
            <h4 class="mb-2">Specifications</h4>
            <table class="table table-bordered">
              ${specTable}
            </table>
          </div>
          <div class="delivery-return">
            <h4 class="mb-2">Delivery & Return</h4>
            <p><i class="bi bi-truck me-2"></i> Delivery: ${product.deliveryTime}</p>
            <p><i class="bi bi-arrow-counterclockwise me-2"></i> Return: ${product.returnPolicy}</p>
          </div>
        </div>
      </div>
      <div class="row mt-5">
        ${recommendationsHTML}
      </div>
    </div>
  `;

  document.getElementById("productDetailPage").innerHTML = detailContent;
  document.getElementById("productDetailSection").dataset.productId = productId;
  document.getElementById("productDetailSection").dataset.selectedColor = defaultColor;
  document.getElementById("productDetailSection").dataset.selectedSize = sizes[0];
  showSection("productDetailSection");

  // Push state to history for navigation
  history.pushState({ section: 'productDetailSection', productId: productId }, '', `#productDetailSection-${productId}`);
}
// Select size
function selectSize(size) {
  document.querySelectorAll(".size-btn").forEach(btn => btn.classList.remove("active"));
  const button = document.querySelector(`.size-btn[data-size="${size}"]`);
  if (button) button.classList.add("active");
  document.getElementById("productDetailSection").dataset.selectedSize = size;
}

// Select color
function selectColor(color) {
  const productId = parseInt(document.getElementById("productDetailSection").dataset.productId);
  const product = products.find(p => p.id === productId);
  if (!product) return;

  document.querySelectorAll(".color-thumbnail").forEach(thumb => thumb.classList.remove("selected"));
  const thumbnail = document.querySelector(`.color-thumbnail[data-color="${color}"]`);
  if (thumbnail) thumbnail.classList.add("selected");

  const imageUrl = product.colorImages[color] || (product.images && product.images.length ? product.images[0] : 'https://via.placeholder.com/400x300?text=' + encodeURIComponent(product.name));
  document.getElementById("mainProductImage").src = imageUrl;
  document.getElementById("productDetailSection").dataset.selectedColor = color;
}
// Add to cart with selection
function addToCartWithSelection(productId) {
  const selectedSize = document.getElementById("sizeSelect")?.value || document.getElementById("productDetailSection").dataset.selectedSize;
  const selectedColor = document.getElementById("productDetailSection").dataset.selectedColor;
  if (!selectedSize || !selectedColor) {
    showNotification("Please select size and color.", "warning");
    return;
  }
  const product = products.find(p => p.id === productId);
  if (product) {
    const cartItem = { ...product, selectedSize, selectedColor };
    cart.push(cartItem);
    showNotification(`${product.name} added to your bag with size ${selectedSize} and color ${selectedColor}.`, "info");
    updateCartCountBadge();
    saveData();
  }
}

// Buy product with selection
// Buy product with selection
function buyProductWithSelection(productId) {
  if (!currentUser) {
    showNotification("Please log in or sign up before placing an order.", "warning");
    showSection("loginSection");
    return;
  }
  const selectedSize = document.getElementById("sizeSelect")?.value || document.getElementById("productDetailSection").dataset.selectedSize;
  const selectedColor = document.getElementById("productDetailSection").dataset.selectedColor;
  if (!selectedSize || !selectedColor) {
    showNotification("Please select size and color.", "warning");
    return;
  }
  const product = products.find(p => p.id === productId);
  if (product) {
    currentProductForPurchase = { ...product, selectedSize, selectedColor };
    const daysRange = product.deliveryTime.match(/\d+-\d+/)[0];
    const maxDays = parseInt(daysRange.split("-")[1]);
    const today = new Date();
    const estimatedDeliveryDate = new Date(today);
    estimatedDeliveryDate.setDate(today.getDate() + maxDays);
    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
    const formattedDate = estimatedDeliveryDate.toLocaleDateString('en-US', options);
    document.getElementById("modalProductName").textContent = product.name;
    document.getElementById("modalProductSize").textContent = selectedSize;
    document.getElementById("modalProductColor").textContent = selectedColor;
    document.getElementById("modalProductPrice").textContent = product.price.toFixed(2);
    document.getElementById("modalDeliveryTime").textContent = formattedDate;
    document.getElementById("modalTotalAmount").textContent = (product.price + 5).toFixed(2); // Assuming +5 for shipping
    
    // Fill hidden fields for EmailJS
    document.getElementById("emailProduct").value = product.name;
    document.getElementById("emailPrice").value = product.price.toFixed(2);
    document.getElementById("emailSize").value = selectedSize;
    document.getElementById("emailColor").value = selectedColor;

    // Clear user fields
    const form = document.getElementById("buyForm");
    if (form) {
      form.reset();
    }

    // Show modal
    const buyModal = new bootstrap.Modal(document.getElementById("buyModal"));
    buyModal.show();
  }
}
// EmailJS integration for Buy Now modal order form
document.addEventListener('DOMContentLoaded', function() {
  // Initialize EmailJS
  if (typeof emailjs !== 'undefined') {
    emailjs.init("uNU6LHQHe2zyexNEo"); // Your EmailJS public key
  }

  const buyFormModal = document.getElementById("buyForm");
  if (buyFormModal) {
    buyFormModal.addEventListener("submit", function (e) {
      e.preventDefault();
      
      // Show loading state
      const submitBtn = this.querySelector('button[type="submit"]');
      const originalText = submitBtn.textContent;
      submitBtn.textContent = "Sending...";
      submitBtn.disabled = true;

      // Get form values
      const address = document.getElementById("shippingAddress").value;
      const mobile = document.getElementById("mobileNumber").value;
      const details = document.getElementById("additionalDetails").value;
      const product = currentProductForPurchase;
 // Send form via EmailJS with proper parameters for BUY NOW
      emailjs.send("service_t95u5og", "template_ciqxjv9", {
        address: address,
        phone: mobile,
        details: details,
        product: product.name,
        price: product.price.toFixed(2),
        size: product.selectedSize,
        color: product.selectedColor,
        buyer_name: currentUser ? `${currentUser.firstName} ${currentUser.lastName}` : "Guest",
        buyer_email: currentUser ? currentUser.email : "No email provided",
        message_type: "new_order"
      })
        .then(function () {
          showNotification("✅ Order placed successfully!", "success");
          buyFormModal.reset();
          const modal = bootstrap.Modal.getInstance(document.getElementById("buyModal"));
          if (modal) modal.hide();
        }, function (error) {
          showNotification("❌ Failed to send order. Please try again.", "danger");
          console.error("EmailJS Error:", error);
        })
        .finally(function() {
          // Reset button state
          submitBtn.textContent = originalText;
          submitBtn.disabled = false;
        });
    });
  }
});
// Buy form submission with enhanced thank-you card
document.getElementById("buyForm").addEventListener("submit", function(e) {
  e.preventDefault();

  if (!currentUser) {
    showNotification("Please log in or sign up before placing an order.", "warning");
    showSection("loginSection");
    return;
  }

  // Retrieve form values
  const address = document.getElementById("shippingAddress").value;
  const mobile = document.getElementById("mobileNumber").value;
  const details = document.getElementById("additionalDetails").value;
  const couponCode = document.getElementById("couponCode").value.trim();
  const product = currentProductForPurchase;

  // Calculate discount if a valid coupon is applied
  let discount = 0;
  if (couponCode && validCoupons.includes(couponCode)) {
    discount = 0.20; // 20% discount
    validCoupons = validCoupons.filter(code => code !== couponCode);
    saveData();
  }
  const finalPrice = product.price * (1 - discount);

  // Calculate estimated delivery date
  const daysRange = product.deliveryTime.match(/\d+-\d+/)[0];
  const maxDays = parseInt(daysRange.split("-")[1]);
  const orderDate = new Date();
  const estimatedDeliveryDate = new Date(orderDate);
  estimatedDeliveryDate.setDate(orderDate.getDate() + maxDays);
  const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
  const formattedDate = estimatedDeliveryDate.toLocaleDateString('en-INDIA', options);

  // Create order object with estimatedDelivery
 const order = {
  product: currentProductForPurchase,
  address,
  mobile,
  details,
  payment: "Cash on Delivery",
  date: orderDate.toLocaleString(),
  cancelled: false,
  cancellationReason: "",
  trackingStatus: "Order Confirmed",
  buyer: currentUser,
  qrData: `Order #${orders.length + 1}\nProduct: ${currentProductForPurchase.name}\nSize: ${currentProductForPurchase.selectedSize}\nColor: ${currentProductForPurchase.selectedColor}\nAddress: ${address}\nMobile: ${mobile}\nBuyer: ${currentUser.firstName} ${currentUser.lastName}\nDate: ${orderDate.toLocaleString()}\nTotal Amount: ₹${finalPrice.toFixed(2)}` ,
  received: false,
  receivedDate: null,
  shipped: false,
  shippedDate: null,
  departed: false,
  departedDate: null,
  rating: null,
  review: null,
  totalAmount: finalPrice.toFixed(2),
  couponUsed: couponCode || null,
  estimatedDelivery: formattedDate 
};

  orders.push(order);
  const orderIndex = orders.length - 1;

  // Generate a new coupon code
  const newCouponCode = generateCouponCode();
  validCoupons.push(newCouponCode);
  saveData();

  // Display thank-you message
  showPopupMessage(`
    <h5>Thank You for Your Order!</h5>
    <img src="${currentProductForPurchase.images[0]}" alt="${currentProductForPurchase.name}" style="max-width: 100px; margin-bottom: 10px;">
    <p><strong>Product:</strong> ${currentProductForPurchase.name}</p>
    <p><strong>Size:</strong> ${currentProductForPurchase.selectedSize}</p>
    <p><strong>Color:</strong> ${currentProductForPurchase.selectedColor}</p>
    <p><strong>Estimated Delivery:</strong> ${formattedDate}</p>
    <p><strong>Shipping Address:</strong> ${address}</p>
    <p><strong>Total Amount:</strong> ₹${finalPrice.toFixed(2)}</p>
    <p>Your order has been placed successfully. We will deliver it to you soon.</p>
    <h6>Coupon for Your Next Order</h6>
    <p><strong>Code:</strong> ${newCouponCode}</p>
    <p>Use this code on your next purchase to get 20% off!</p>
    <button class="btn btn-primary mt-3" data-bs-dismiss="modal" onclick="showOrderDetailPage(${orderIndex})">View Order Details</button>
  `);

  notifyOwner(`New order placed by: ${currentUser.firstName} ${currentUser.lastName} (${currentUser.email}) for product: ${order.product.name} (Size: ${order.product.selectedSize}, Color: ${order.product.selectedColor}) at ₹${finalPrice.toFixed(2)} - Order #${orderIndex + 1}`);

  saveData();
  const buyModal = bootstrap.Modal.getInstance(document.getElementById("buyModal"));
  buyModal.hide();
});

// Update cart count badge
function updateCartCountBadge() {
  document.getElementById("footerBagBadge").textContent = cart.length;
}

// Update cart section
function updateCartSection() {
  const cartContent = document.getElementById("cartContent");
  if (cart.length === 0) {
    cartContent.innerHTML = "<p>Your bag is empty.</p>";
    return;
  }
  let html = "";
  cart.forEach((item, index) => {
    html += `
      <div class="card mb-3 shadow-sm product-card" onclick="showProductDetails(${item.id})" style="cursor: pointer;">
        <div class="row g-0">
          <div class="col-4">
            <img src="${item.images && item.images.length ? item.images[0] : 'https://via.placeholder.com/400x300?text=' + encodeURIComponent(item.name)}" class="img-fluid rounded-start" alt="${item.name}">
          </div>
          <div class="col-8">
            <div class="card-body">
              <h5 class="card-title">${item.name}</h5>
              <p class="card-text">${item.description}</p>
              <p class="card-text">Size: ${item.selectedSize}, Color: ${item.selectedColor}</p>
              <p class="card-text"><small class="text-muted">${item.category} |  ₹${(item.price * 1.2).toFixed(2)}₹${item.price.toFixed(2)}</small></p>
              <button class="btn btn-sm btn-danger" onclick="event.stopPropagation(); removeFromCart(${index})"><i class="bi bi-trash me-1"></i> Remove</button>
            </div>
          </div>
        </div>
      </div>
    `;
  });
  cartContent.innerHTML = html;
}

// Remove from cart
function removeFromCart(index) {
  if (confirm("Are you sure you want to remove this item from your bag?")) {
    cart.splice(index, 1);
    updateCartSection();
    updateCartCountBadge();
    showNotification("Item removed from bag.", "info");
    saveData();
  }
}

// Update account section
function updateAccountSection() {
  const accountContent = document.getElementById("accountContent");
  if (currentUser) {
    accountContent.innerHTML = `
      <div class="card shadow-sm">
        <div class="card-body">
          <h3>Hello, ${currentUser.firstName} ${currentUser.lastName}</h3>
          <p><strong>Email:</strong> ${currentUser.email}</p>
          <p><strong>Mobile Number:</strong> ${currentUser.mobile || "Not provided"}</p>
          <button class="btn btn-secondary" onclick="logout()">Logout</button>
        </div>
      </div>
    `;
  } else {
    accountContent.innerHTML = "<p>No user details available. Please log in.</p>";
  }
}

// Calculate estimated delivery dates
function calculateDeliveryDate(orderDate, deliveryTime) {
  const [minDays, maxDays] = deliveryTime.split('-').map(s => parseInt(s.trim().replace(' days', '')));
  const orderDateObj = new Date(orderDate);
  const minDeliveryDate = new Date(orderDateObj);
  minDeliveryDate.setDate(orderDateObj.getDate() + minDays);
  const maxDeliveryDate = new Date(orderDateObj);
  maxDeliveryDate.setDate(orderDateObj.getDate() + maxDays);
  return {
    min: minDeliveryDate.toLocaleDateString(),
    max: maxDeliveryDate.toLocaleDateString()
  };
}
// Update orders list
function updateOrdersList(filter = currentOrdersFilter) {
  const ordersList = document.getElementById('ordersList');
  if (!currentUser) {
    ordersList.innerHTML = `
      <div class="text-center py-5">
        <i class="bi bi-box-seam" style="font-size: 3rem; color: #ddd;"></i>
        <h5 class="mt-3">No orders found</h5>
        <p>Please log in to view your orders</p>
        <button class="btn btn-primary mt-2" onclick="showSection('loginSection')">Log In</button>
      </div>
    `;
    return;
  }

  const userOrders = orders.filter(order => order.buyer.email === currentUser.email);
  let filteredOrders = [];

  switch (filter) {
    case 'active':
      filteredOrders = userOrders.filter(order => !order.cancelled && !order.received && !order.returned);
      break;
    case 'completed':
      filteredOrders = userOrders.filter(order => order.received && !order.returned);
      break;
    case 'cancelled':
      filteredOrders = userOrders.filter(order => order.cancelled);
      break;
    case 'returned':
      filteredOrders = userOrders.filter(order => order.returned);
      break;
    default:
      filteredOrders = userOrders;
  }

  if (filteredOrders.length === 0) {
    let message = filter === 'active' ? 'You have no active orders' :
                  filter === 'completed' ? 'You have no completed orders' :
                  filter === 'cancelled' ? 'You have no cancelled orders' :
                  filter === 'returned' ? 'You have no returned orders' :
                  'You have not placed any orders yet';
    ordersList.innerHTML = `
      <div class="text-center py-5">
        <i class="bi bi-box-seam" style="font-size: 3rem; color: #ddd;"></i>
        <h5 class="mt-3">${message}</h5>
        <button class="btn btn-primary mt-2" onclick="showSection('shopSection')">Start Shopping</button>
      </div>
    `;
    return;
  }

  let html = '';
  filteredOrders.forEach((order, index) => {
    const originalIndex = orders.findIndex(o => o === order);
    const productImage = order.product.images && order.product.images.length > 0 ?
      order.product.images[0] : 'https://via.placeholder.com/100x100?text=No+Image';
    const discount = order.product.discount || 0;
    const originalPrice = discount > 0 ? (order.product.price / (1 - discount / 100)).toFixed(2) : order.product.price.toFixed(2);

    let statusBadgeClass, statusText;
    if (order.cancelled) {
      statusBadgeClass = 'order-status-cancelled';
      statusText = 'Cancelled';
    } else if (order.returned) {
      statusBadgeClass = 'order-status-returned';
      statusText = 'Returned';
    } else if (order.received) {
      statusBadgeClass = 'order-status-delivered';
      statusText = 'Delivered';
    } else if (order.shipped) {
      statusBadgeClass = 'order-status-shipped';
      statusText = 'Shipped';
    } else {
      statusBadgeClass = 'order-status-confirmed';
      statusText = 'Confirmed';
    }

    html += `
      <div class="card order-card mb-3 ${order.cancelled ? 'cancelled-order' : order.returned ? 'returned-order' : ''}"
           onclick="showOrderDetailPage(${originalIndex})">
        <div class="card-header d-flex justify-content-between align-items-center">
          <div>
            <span class="fw-bold">Order #${originalIndex + 1}</span>
            <span class="text-muted ms-2">${order.date}</span>
          </div>
          <span class="order-status-badge ${statusBadgeClass}">${statusText}</span>
        </div>
        <div class="card-body">
          ${!order.cancelled && !order.received && !order.returned ? `
            <p class="small text-muted mb-2">Estimated Delivery: By ${order.estimatedDelivery}</p>
          ` : ''}
          <div class="row align-items-center">
            <div class="col-4 col-md-2">
              <img src="${productImage}"
                   class="order-card-image"
                   alt="${order.product.name}"
                   onclick="event.stopPropagation(); showProductImagesModal(${order.product.id})">
            </div>
            <div class="col-8 col-md-10">
              <h6>${order.product.name}</h6>
              <p class="mb-1">Size: ${order.product.selectedSize}, Color: ${order.product.selectedColor}</p>
              <p class="mb-1">Qty: 1</p>
              <p class="fw-bold">₹${order.product.price.toFixed(2)}</p>
              ${discount > 0 ? `<p class="text-muted"> ₹${originalPrice}  (${discount}% off)</p>` : ''}
            </div>
          </div>
        </div>
      </div>
    `;
  });
  ordersList.innerHTML = html;
}
// Filter orders
function filterOrders(filter) {
  currentOrdersFilter = filter;
  updateOrdersList(filter);
}

// **Generate Track Bar Function**
function generateTrackBar(order) {
  let steps = [];
  if (order.cancelled) {
    steps = [
      { title: 'Order Placed', active: true },
      { title: 'Cancelled', active: true }
    ];
  } else if (order.returned) {
    steps = [
      { title: 'Order Placed', active: true },
      { title: 'Shipped', active: true },
      { title: 'Delivered', active: true },
      { title: 'Returned', active: true }
    ];
  } else {
    steps = [
      { title: 'Order Placed', active: true },
      { title: 'Shipped', active: order.shipped || order.received },
      { title: 'Delivered', active: order.received }
    ];
  }

  let html = '<div class="track-bar">';
  steps.forEach((step, index) => {
    html += `
      <div class="track-step ${step.active ? 'active' : ''}">
        <span class="step-icon">${index + 1}</span>
        <p>${step.title}</p>
      </div>
    `;
    if (index < steps.length - 1) {
      const lineActive = step.active && steps[index + 1].active;
      html += `<div class="track-line ${lineActive ? 'active' : ''}"></div>`;
    }
  });
  html += '</div>';
  return html;
}
function showOrderDetailPage(orderIndex) {
  currentOrderIndex = orderIndex;
  const order = orders[orderIndex];
  const productImage = order.product.images && order.product.images.length > 0 ?
    order.product.images[0] :
    'https://via.placeholder.com/400x300?text=' + encodeURIComponent(order.product.name);

  // Parse dates for comparison
  const estimatedDeliveryDate = new Date(order.estimatedDelivery);
  const currentDate = new Date();
  const isPastEstimatedDelivery = currentDate > estimatedDeliveryDate;
  const product = order.product;

  // Cancel button logic: disable if past estimated delivery
  let cancelDisabled = '';
  if (isPastEstimatedDelivery) {
    cancelDisabled = 'disabled';
  }

  // Return button logic: disable if no return allowed or past return deadline
  let returnDisabled = '';
  if (order.received) {
    const allowsReturn = /\d+ days return policy/.test(product.returnPolicy);
    if (!allowsReturn) {
      returnDisabled = 'disabled';
    } else {
      const returnDays = parseInt(product.returnPolicy.match(/\d+/)[0]);
      const receivedDate = new Date(order.receivedDate);
      const returnDeadline = new Date(receivedDate);
      returnDeadline.setDate(receivedDate.getDate() + returnDays);
      if (currentDate > returnDeadline) {
        returnDisabled = 'disabled';
      }
    }
  }

  // Delete button for cancelled or returned orders
  let deleteButton = '';
  if (order.cancelled || order.returned) {
    deleteButton = `
      <button class="btn btn-danger mt-3" onclick="deleteOrder(${orderIndex})">
        <i class="bi bi-trash me-1"></i> Delete Order
      </button>
    `;
  }

  // Status badge logic
  let statusBadgeClass, statusText;
  if (order.cancelled) {
    statusBadgeClass = 'order-status-cancelled';
    statusText = 'Cancelled';
  } else if (order.returned) {
    statusBadgeClass = 'order-status-returned';
    statusText = 'Returned';
  } else if (order.received) {
    statusBadgeClass = 'order-status-delivered';
    statusText = 'Delivered';
  } else if (order.shipped) {
    statusBadgeClass = 'order-status-shipped';
    statusText = 'Shipped';
  } else {
    statusBadgeClass = 'order-status-confirmed';
    statusText = 'Confirmed';
  }

  // Timeline items
  let timelineItems = [];
  if (order.cancelled) {
    timelineItems = [
      { date: order.date, title: 'Order Placed', description: 'Your order was placed', active: true },
      { date: order.cancellationDate || order.date, title: 'Order Cancelled', description: 'Your order was cancelled', active: true }
    ];
  } else if (order.returned) {
    timelineItems = [
      { date: order.date, title: 'Order Placed', description: 'Your order was placed', active: true },
      ...(order.shipped ? [{ date: order.shippedDate || order.date, title: 'Shipped', description: 'Your order was shipped', active: true }] : []),
      ...(order.received ? [{ date: order.receivedDate || order.date, title: 'Delivered', description: 'Your order was delivered', active: true }] : []),
      { date: order.returnDate || order.date, title: 'Returned', description: 'Your order was returned', active: true }
    ];
  } else {
    timelineItems = [
      { date: order.date, title: 'Order Placed', description: 'Your order has been confirmed', active: true }
    ];
    if (order.shipped) {
      timelineItems.push({
        date: order.shippedDate || order.date,
        title: 'Shipped',
        description: 'Your order has been shipped',
        active: true
      });
    }
    if (order.received) {
      timelineItems.push({
        date: order.receivedDate || order.date,
        title: 'Delivered',
        description: 'Your order has been delivered',
        active: true
      });
    } else {
      timelineItems.push({
        date: '',
        title: 'Estimated Delivery',
        description: `By ${order.estimatedDelivery}`,
        active: false
      });
    }
  }

  let timelineHtml = '';
  timelineItems.forEach((item) => {
    timelineHtml += `
      <div class="timeline-item ${item.active ? 'active' : ''}">
        <h6>${item.title}</h6>
        <p class="mb-1">${item.description}</p>
        ${item.date ? `<p class="timeline-date text-muted">${item.date}</p>` : ''}
      </div>
    `;
  });

  // Action buttons with dynamic disabling
  let actionButtons = '';
  if (!order.cancelled && !order.received && !order.returned) {
    actionButtons += `
      <div class="d-flex gap-2">
        <button class="btn btn-success flex-grow-1" onclick="markAsReceived(${orderIndex})">
          <i class="bi bi-check-circle me-1"></i> Mark as Received
        </button>
        <button class="btn btn-outline-danger flex-grow-1"
                data-bs-toggle="modal"
                data-bs-target="#cancelOrderModal"
                ${cancelDisabled}>
          <i class="bi bi-x-circle me-1"></i> Cancel Order
        </button>
      </div>
    `;
  }
  if (order.received && !order.returned) {
    actionButtons += `
      <button class="btn btn-warning mt-2" data-bs-toggle="modal" data-bs-target="#returnOrderModal" ${returnDisabled}>
        <i class="bi bi-arrow-return-left me-1"></i> Return Order
      </button>
    `;
    if (!order.rating) {
      actionButtons += `
        <button class="btn btn-primary mt-2" data-bs-toggle="modal" data-bs-target="#reviewOrderModal">
          <i class="bi bi-star me-1"></i> Rate & Review
        </button>
      `;
    } else {
      actionButtons += `
        <button class="btn btn-outline-primary mt-2" data-bs-toggle="modal" data-bs-target="#viewReviewModal">
          <i class="bi bi-star-fill me-1"></i> View Your Review
        </button>
      `;
    }
  }

  const trackBarHtml = generateTrackBar(order);

  // Full detail content
  const detailContent = `
    <div class="row">
      <div class="col-md-8">
        <div class="order-detail-section">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h4>Order #${orderIndex + 1}</h4>
            <span class="order-status-badge ${statusBadgeClass}">${statusText}</span>
          </div>
          ${order.received ? `
            <p class="text-muted"><strong>Delivered on:</strong> ${order.receivedDate}</p>
          ` : `
            <p class="text-muted"><strong>Estimated Delivery:</strong> By ${order.estimatedDelivery}</p>
          `}
          ${trackBarHtml}
          <div class="order-timeline">
            ${timelineHtml}
          </div>
          ${order.cancelled && order.cancellationReason ? `
            <div class="alert alert-danger mt-3">
              <h6>Cancellation Reason</h6>
              <p>${order.cancellationReason}</p>
            </div>
          ` : ''}
          ${order.returned ? `
            <div class="alert alert-warning mt-3">
              <h6>Return Details</h6>
              <p><strong>Reason:</strong> ${order.returnReason}</p>
              ${order.returnComments ? `<p><strong>Comments:</strong> ${order.returnComments}</p>` : ''}
              <p><strong>Returned on:</strong> ${order.returnDate}</p>
            </div>
          ` : ''}
        </div>
        <div class="order-actions mt-4">
          ${actionButtons}
          ${deleteButton}
        </div>
      </div>
      <div class="col-md-4">
        <div class="order-detail-section">
          <h5 class="mb-3">Order Summary</h5>
          <div class="d-flex mb-3">
            <img src="${productImage}" class="rounded me-3" style="width: 150px; height: 150px; object-fit: cover; cursor: pointer;"
                 alt="${order.product.name}" onclick="showProductImagesModal(${order.product.id})">
            <div>
              <h6>${order.product.name}</h6>
              <p class="mb-1 small">Size: ${order.product.selectedSize}, Color: ${order.product.selectedColor}</p>
              <p class="mb-1 small">Qty: 1</p>
              <p class="fw-bold">₹${order.product.price.toFixed(2)}</p>
            </div>
          </div>
          <hr>
          <div class="mb-2 d-flex justify-content-between">
            <span>Subtotal:</span>
            <span>₹${order.product.price.toFixed(2)}</span>
          </div>
          <div class="mb-2 d-flex justify-content-between">
            <span>Shipping:</span>
            <span>FREE</span>
          </div>
          <div class="mb-3 d-flex justify-content-between">
            <span>Tax:</span>
            <span>₹0.00</span>
          </div>
          <hr>
          <div class="d-flex justify-content-between fw-bold">
            <span>Total:</span>
            <span>₹${order.product.price.toFixed(2)}</span>
          </div>
          <hr>
          <h6 class="mb-2">Payment Method</h6>
          <p class="mb-3">${order.payment}</p>
          <h6 class="mb-2">Shipping Address</h6>
          <p class="mb-1">${order.address}</p>
          <p class="mb-3">Phone: ${order.mobile}</p>
          <button class="btn btn-outline-primary w-100" onclick="showProductDetails(${order.product.id})">
            <i class="bi bi-cart me-1"></i> Buy Again
          </button>
        </div>
      </div>
    </div>
  `;

  document.getElementById("orderDetailPage").innerHTML = detailContent;
  showSection("orderDetailSection");
}
// Delete order
function deleteOrder(orderIndex) {
  if (confirm("Are you sure you want to delete this order? This action cannot be undone.")) {
    orders.splice(orderIndex, 1);
    saveData();
    showNotification("Order deleted successfully.", "success");
    showSection("ordersSection");
    updateOrdersList();
  }
}

function markAsReceived(orderIndex) {
  orders[orderIndex].received = true;
  orders[orderIndex].receivedDate = new Date().toLocaleString();
  showNotification('Order marked as received', 'success');
  saveData();
  showOrderDetailPage(orderIndex);
  updateOrdersList(currentOrdersFilter);
}

function confirmCancelOrder() {
  const reasonSelect = document.getElementById('cancelReason');
  const otherReason = document.getElementById('otherReason');
  const address = document.getElementById('cancelAddress').value;
  const mobile = document.getElementById('cancelMobile').value;
  const details = document.getElementById('cancelDetails').value;
  
  let reason = reasonSelect.value;

  if (reason === '') {
    showNotification('Please select a cancellation reason', 'warning');
    return;
  }

  if (reason === 'Other') {
    reason = otherReason.value.trim();
    if (reason === '') {
      showNotification('Please specify the cancellation reason', 'warning');
      return;
    }
  }

  if (!address.trim()) {
    showNotification('Please enter your address', 'warning');
    return;
  }

  if (!mobile.trim()) {
    showNotification('Please enter your mobile number', 'warning');
    return;
  }

  // Show loading state
  const submitBtn = document.querySelector('#cancelOrderModal .btn-danger');
  const originalText = submitBtn.textContent;
  submitBtn.textContent = "Sending...";
  submitBtn.disabled = true;

  const order = orders[currentOrderIndex];
  const product = order.product;
  // Send cancellation request via EmailJS with CANCEL template
  emailjs.send("service_t95u5og", "template_yalbgw5", {
    address: address,
    phone: mobile,
    details: details,
    product: product.name,
    price: product.price.toFixed(2),
    size: product.selectedSize,
    color: product.selectedColor,
    buyer_name: currentUser ? `${currentUser.firstName} ${currentUser.lastName}` : "Guest",
    buyer_email: currentUser ? currentUser.email : "No email provided",
    cancellation_reason: reason,
    order_id: currentOrderIndex + 1,
    message_type: "cancellation_request"
  })
    .then(function () {
      showNotification("✅ Cancellation request sent successfully!", "success");
      
      // Update order status
      orders[currentOrderIndex].cancelled = true;
      orders[currentOrderIndex].cancellationReason = reason;
      orders[currentOrderIndex].cancellationDate = new Date().toLocaleString();
      orders[currentOrderIndex].cancellationAddress = address;
      orders[currentOrderIndex].cancellationMobile = mobile;
      orders[currentOrderIndex].cancellationDetails = details;

      notifyOwner(`Order #${currentOrderIndex + 1} cancellation requested by: ${currentUser.firstName} ${currentUser.lastName} (${currentUser.email}) for product: ${product.name} with reason: ${reason}`);

      saveData();

      const modal = bootstrap.Modal.getInstance(document.getElementById('cancelOrderModal'));
      modal.hide();

      setTimeout(() => {
        showOrderDetailPage(currentOrderIndex);
        updateOrdersList(currentOrdersFilter);
      }, 500);
    }, function (error) {
      showNotification("❌ Failed to send cancellation request. Please try again.", "danger");
      console.error("EmailJS Error:", error);
    })
    .finally(function() {
      // Reset button state
      submitBtn.textContent = originalText;
      submitBtn.disabled = false;
    });
}


// Handle cancel reason select change
document.getElementById('cancelReason')?.addEventListener('change', function() {
  const otherReasonContainer = document.getElementById('otherReasonContainer');
  if (this.value === 'Other') {
    otherReasonContainer.style.display = 'block';
  } else {
    otherReasonContainer.style.display = 'none';
  }
});

// Initialize rating when review modal is shown
document.getElementById('reviewOrderModal')?.addEventListener('show.bs.modal', function() {
  const order = orders[currentOrderIndex];
  const ratingStars = document.getElementById('ratingStars');

  ratingStars.querySelectorAll('span').forEach(star => {
    star.textContent = '☆';
  });

  if (order.rating) {
    highlightStars(order.rating);
  }

  document.getElementById('ratingText').textContent = 'Tap to rate';

  document.getElementById('reviewTitle').value = '';
  document.getElementById('reviewText').value = '';
});

// Handle star rating selection
document.getElementById('ratingStars')?.addEventListener('click', function(e) {
  if (e.target.tagName === 'SPAN') {
    const value = parseInt(e.target.getAttribute('data-value'));
    highlightStars(value);

    const ratingText = document.getElementById('ratingText');
    ratingText.textContent = `${value} star${value !== 1 ? 's' : ''}`;
    ratingText.style.color = '#000';

    document.getElementById('ratingStars').dataset.selectedRating = value;
  }
});

// Function to highlight stars up to the selected value
function highlightStars(value) {
  const stars = document.getElementById('ratingStars').querySelectorAll('span');
  stars.forEach((star, index) => {
    const starValue = parseInt(star.getAttribute('data-value'));
    star.textContent = starValue <= value ? '★' : '☆';
    star.style.color = starValue <= value ? 'gold' : '#000';
  });
}

// Submit review function
function submitReview() {
  const ratingStars = document.getElementById('ratingStars');
  const selectedRating = ratingStars.dataset.selectedRating;
  const reviewTitle = document.getElementById('reviewTitle').value.trim();
  const reviewText = document.getElementById('reviewText').value.trim();

  if (!selectedRating) {
    showNotification('Please select a rating by tapping the stars', 'warning');
    return;
  }

  if (!reviewTitle) {
    showNotification('Please enter a title for your review', 'warning');
    return;
  }

  if (!reviewText) {
    showNotification('Please write your review', 'warning');
    return;
  }

  const order = orders[currentOrderIndex];
  order.rating = parseInt(selectedRating);
  order.reviewTitle = reviewTitle;
  order.review = reviewText;
  order.reviewDate = new Date().toLocaleString();

  saveData();

  const modal = bootstrap.Modal.getInstance(document.getElementById('reviewOrderModal'));
  modal.hide();

  showNotification('Thank you for your review!', 'success');

  showOrderDetailPage(currentOrderIndex);
}

// Confirm return order function
function confirmReturnOrder() {
  const returnReason = document.getElementById('returnReason').value;
  const returnOtherReason = document.getElementById('returnOtherReason').value.trim();
  const returnComments = document.getElementById('returnComments').value.trim();

  let reason = returnReason;
  if (returnReason === 'Other') {
    if (!returnOtherReason) {
      showNotification('Please specify the return reason', 'warning');
      return;
    }
    reason = returnOtherReason;
  }

  const order = orders[currentOrderIndex];
  order.returned = true;
  order.returnReason = reason;
  order.returnComments = returnComments;
  order.returnDate = new Date().toLocaleString();

  notifyOwner(`Order #${currentOrderIndex + 1} returned by: ${currentUser.firstName} ${currentUser.lastName} (${currentUser.email}) with reason: ${reason}`);

  saveData();

  const modal = bootstrap.Modal.getInstance(document.getElementById('returnOrderModal'));
  modal.hide();

  showNotification('Your return request has been submitted', 'success');

  showOrderDetailPage(currentOrderIndex);
}

// Update the view review modal when shown
document.getElementById('viewReviewModal')?.addEventListener('show.bs.modal', function() {
  const order = orders[currentOrderIndex];
  const modal = document.getElementById('viewReviewModal');

  if (!order.rating) return;

  modal.querySelector('.modal-title').textContent = `Your Review of ${order.product.name}`;

  const starsContainer = modal.querySelector('.rating-stars');
  starsContainer.innerHTML = '';
  for (let i = 1; i <= 5; i++) {
    starsContainer.innerHTML += i <= order.rating ? '★' : '☆';
  }

  modal.querySelector('h5').textContent = order.reviewTitle || 'Your Review';
  modal.querySelector('p').textContent = order.review || 'No review text provided.';
  modal.querySelector('.small').textContent = `Reviewed on ${order.reviewDate || 'Unknown date'}`;
});

// Show section
function showSection(sectionId) {
  document.querySelectorAll(".section").forEach(section => section.classList.remove("active-section", "fade-in"));
  const targetSection = document.getElementById(sectionId);
  targetSection.classList.add("active-section", "fade-in");
  if (sectionId !== "productDetailSection") {
    delete document.getElementById("productDetailSection").dataset.selectedSize;
    delete document.getElementById("productDetailSection").dataset.selectedColor;
  }
  updateUserActivity();
  if (sectionId === "shopSection") {
    applyFilters();
  } else if (sectionId === "menswearSection") {
    applyMenswearFilters();
  } else if (sectionId === "accessoriesSection") {
    applyAccessoriesFilters();
  } else if (sectionId === "accountSection") {
    updateAccountSection();
  } else if (sectionId === "cartSection") {
    updateCartSection();
  } else if (sectionId === "notificationsSection") {
    updateNotifications();
  } else if (sectionId === "ordersSection") {
    updateOrdersList();
  } else if (sectionId === "sellerDashboard" || sectionId === "ownerDashboard") {
    if (currentUser && currentUser.email === "tedpole.in@gmail.com") {
      sectionId === "sellerDashboard" ? updateSellerDashboard() : updateOwnerDashboard();
    } else {
      showNotification("Access denied. Only the owner can view this dashboard.", "danger");
      showSection("homeSection");
    }
  }
}

// Generate product image HTML
function generateProductImageHTML(product) {
  const defaultColor = product.color.split(",")[0].trim();
  const defaultImage = product.colorImages[defaultColor];
  return `<img id="mainProductImage" src="${defaultImage}" class="product-detail-img" alt="${product.name}" style="cursor: pointer;" onclick="showProductImagesModal(${product.id})">`;
}

 // Update menu account details
             function updateMenuAccountDetails() {
               const container = document.getElementById("menuAccountDetails");
               if (currentUser) {
                 container.innerHTML = `<i class="bi bi-person-circle me-2"></i><h4 class="d-inline">${currentUser.firstName} ${currentUser.lastName}</h4><br><small>${currentUser.email}</small>`;
                 if (currentUser.email === "tedpole.in@gmail.com") {
                   document.getElementById("sellerDashboardMenuItem").style.display = "block";
                   document.getElementById("ownerDashboardMenuItem").style.display = "block";
                 }
               } else {
                 container.innerHTML = `<h4>Welcome Guest</h4>`;
                 document.getElementById("sellerDashboardMenuItem").style.display = "none";
                 document.getElementById("ownerDashboardMenuItem").style.display = "none";
               }
             }
         
             // Logout
             function logout() {
               if (currentUser) {
                 currentUser.isLoggedIn = false;
                 currentUser.lastActivity = new Date().toISOString();
               }
               currentUser = null;
               showNotification("You have been logged out.", "info");
               saveData();
               updateHeaderProfile();
               updateMenuAccountDetails();
               showSection("homeSection");
             }
         
             // Header button actions
             document.getElementById("accountButton").addEventListener("click", () => currentUser ? showSection("accountSection") : showSection("loginSection"));
             document.getElementById("notificationButton").addEventListener("click", () => showSection("notificationsSection"));
         // Feedback form submission
document.getElementById("feedbackForm")?.addEventListener("submit", function(e) {
  e.preventDefault();
  const feedbackMessage = document.getElementById("feedbackMessage").value.trim();
  if (!feedbackMessage) {
    showNotification("Please enter your feedback.", "warning");
    return;
  }
  const feedback = {
    user: currentUser ? `${currentUser.firstName} ${currentUser.lastName} (${currentUser.email})` : "Guest",
    message: feedbackMessage,
    date: new Date().toLocaleString()
  };
  notifyOwner(`New feedback received from ${feedback.user}: ${feedback.message}`);
  showNotification("Thank you for your feedback!", "success");
  this.reset();
  showSection("homeSection");
});
             // Enhanced search functionality
         function showSearchSuggestions() {
           const input = document.getElementById("searchSectionInput").value.toLowerCase();
           const suggestionsContainer = document.getElementById("searchSuggestions");
           
           if (input.length < 2) {
             suggestionsContainer.style.display = "none";
             return;
           }
           
           const suggestions = products.filter(product => 
             product.name.toLowerCase().includes(input) || 
             product.description.toLowerCase().includes(input) ||
             product.category.toLowerCase().includes(input)
           ).slice(0, 5);
           
           if (suggestions.length === 0) {
             suggestionsContainer.style.display = "none";
             return;
           }
           
           let html = '';
           suggestions.forEach(product => {
             html += `
               <a href="#" class="list-group-item list-group-item-action" 
                  onclick="event.preventDefault(); document.getElementById('searchSectionInput').value='${product.name}'; suggestionsContainer.style.display='none';">
                 <div class="d-flex align-items-center">
                   <img src="${product.images[0]}" alt="${product.name}" style="width: 40px; height: 40px; object-fit: cover; margin-right: 10px;">
                   <div>
                     <h6 class="mb-0">${product.name}</h6>
                     <small class="text-muted">${product.category}</small>
                   </div>
                 </div>
               </a>
             `;
           });
           
           suggestionsContainer.innerHTML = html;
           suggestionsContainer.style.display = "block";
         }
         
         function performSearch() {
           const query = document.getElementById("searchSectionInput").value.toLowerCase();
           const category = document.getElementById("searchCategory").value;
           const priceRange = document.getElementById("searchPrice").value;
           const minRating = document.getElementById("searchRating").value;
           const sortBy = document.getElementById("searchSort").value;
           
           let filteredProducts = [...products];
           
           // Apply search query
           if (query) {
             filteredProducts = filteredProducts.filter(p => 
               p.name.toLowerCase().includes(query) || 
               p.description.toLowerCase().includes(query)
           )}
           
           // Apply category filter
           if (category) {
             filteredProducts = filteredProducts.filter(p => p.category === category);
           }
           
           // Apply price range filter
           if (priceRange) {
             const [min, max] = priceRange.split("-").map(Number);
             filteredProducts = filteredProducts.filter(p => {
               if (max) return p.price >= min && p.price <= max;
               return p.price >= min;
             });
           }
           
           // Apply rating filter
           if (minRating) {
             filteredProducts = filteredProducts.filter(p => {
               const ratingInfo = getProductRating(p.id);
               return ratingInfo && ratingInfo.average >= minRating;
             });
           }
           
           // Apply sorting
           switch(sortBy) {
             case "price-low":
               filteredProducts.sort((a, b) => a.price - b.price);
               break;
             case "price-high":
               filteredProducts.sort((a, b) => b.price - a.price);
               break;
             case "rating":
               filteredProducts.sort((a, b) => {
                 const ratingA = getProductRating(a.id)?.average || 0;
                 const ratingB = getProductRating(b.id)?.average || 0;
                 return ratingB - ratingA;
               });
               break;
             case "newest":
               // Assuming newer products have higher IDs
               filteredProducts.sort((a, b) => b.id - a.id);
               break;
             default:
               // Relevance - products matching query come first
               if (query) {
                 filteredProducts.sort((a, b) => {
                   const aMatches = a.name.toLowerCase().includes(query) ? 1 : 0;
                   const bMatches = b.name.toLowerCase().includes(query) ? 1 : 0;
                   return bMatches - aMatches;
                 });
               }
           }
           
           displaySearchResults(filteredProducts);
           updateSearchActiveFilters(query, category, priceRange, minRating);
         }
         
         function displaySearchResults(results) {
           const container = document.getElementById("searchResultsContainer");
           const countElement = document.getElementById("searchResultsCount");
           
           countElement.textContent = `${results.length} ${results.length === 1 ? 'product' : 'products'} found`;
           
           if (results.length === 0) {
             container.innerHTML = `
               <div class="col-12 text-center py-5">
                 <i class="bi bi-search" style="font-size: 3rem; color: #ccc;"></i>
                 <h4 class="mt-3">No </h4>
                 <p>Try adjusting your search or filters</p>
                 <button class="btn btn-primary" onclick="clearSearchFilters()">Clear all filters</button>
               </div>
             `;
             return;
           }
           
           container.innerHTML = "";
           results.forEach(product => {
             const ratingInfo = getProductRating(product.id);
             const originalPrice = (product.price * 1.2).toFixed(2);
             const discount = ((originalPrice - product.price) / originalPrice * 100).toFixed(0);
             
             const card = `
               <div class="col-6 col-md-4 col-lg-3 mb-4">
                 <div class="card h-100 product-card" onclick="showProductDetails(${product.id})">
                   <div style="position: relative;">
                     <img src="${product.images[0]}" class="card-img-top" alt="${product.name}" style="height: 200px; object-fit: cover;">
            ${discount > 0 ? `<span class="badge bg-danger position-absolute top-0 start-0 m-2">${discount}% OFF</span>` : ''}
                     </button>
                   </div>
                   <div class="card-body">
                     <h5 class="card-title">${product.name}</h5>
                     <p class="card-text text-muted" style="font-size: 0.9rem;">${product.description}</p>
                     <div class="d-flex justify-content-between align-items-center">
                       <div>
                         <span class="fw-bold">₹${product.price.toFixed(2)}</span>
                         ${discount > 0 ? `<small class="text-decoration-line-through text-muted ms-1">₹${originalPrice}</small>` : ''}
                       </div>
                       ${ratingInfo ? `
                         <div class="d-flex align-items-center">
                           <i class="bi bi-star-fill text-warning me-1"></i>
                           <small>${ratingInfo.average}</small>
                         </div>
                       ` : ''}
                     </div>
                   </div>
                 </div>
               </div>
             `;
             container.innerHTML += card;
           });
         }
         
         function updateSearchActiveFilters(query, category, priceRange, minRating) {
           const container = document.getElementById("searchActiveFilters");
           let html = '';
           
           if (query) html += `<span class="badge bg-secondary me-2">Search: ${query}</span>`;
           if (category) html += `<span class="badge bg-primary me-2">Category: ${category}</span>`;
           if (priceRange) {
             const label = priceRange === "0-100" ? "Under ₹100" : 
                          priceRange === "100-200" ? "₹100-₹200" :
                          priceRange === "200-300" ? "₹200-₹300" : "₹300-₹500";
             html += `<span class="badge bg-info me-2">Price: ${label}</span>`;
           }
           if (minRating) html += `<span class="badge bg-warning me-2">Rating: ${minRating}+</span>`;
           
           container.innerHTML = html;
         }
         
         function clearSearchFilters() {
           document.getElementById("searchSectionInput").value = "";
           document.getElementById("searchCategory").value = "";
           document.getElementById("searchPrice").value = "";
           document.getElementById("searchRating").value = "";
           document.getElementById("searchSort").value = "relevance";
           document.getElementById("searchActiveFilters").innerHTML = "";
           displaySearchResults(products);
           document.getElementById("searchResultsCount").textContent = `${products.length} `;
         }
         
             // Login form submission
             document.getElementById("loginForm")?.addEventListener("submit", function(e) {
                 e.preventDefault();
               
                 // Retrieve input values
                 const email = document.getElementById("loginEmail").value;
                 const password = document.getElementById("loginPassword").value;
               
                 // Check if the user exists and the password matches
                 const user = users.find(u => u.email === email && u.password === password);
               
                 if (user) {
                   // Set current user and update properties
                   currentUser = user;
                   currentUser.isLoggedIn = true;
                   currentUser.lastActivity = new Date().toISOString();
               
                   // Show notification for successful login
                   showNotification("Login successful!", "success");
               
                   // Notify owner about the successful login with user's details
                   notifyOwner(`User logged in: ${currentUser.firstName} ${currentUser.lastName} (${currentUser.email})`);
               
                   // Persist data and update the UI accordingly
                   saveData();
                   updateHeaderProfile();
                   updateMenuAccountDetails();
                   showSection("homeSection");
                 } else {
                   // Show warning if credentials are invalid
                   showNotification("Invalid email or password. Please sign up if you don't have an account.", "warning");
                 }
               });
               
         
          // Sign up form submission
     document.getElementById("signupForm")?.addEventListener("submit", function(e) {
         e.preventDefault();
       
         // Retrieve form values
         const firstName = document.getElementById("firstName").value;
         const lastName = document.getElementById("lastName").value;
         const mobile = document.getElementById("mobileNumberSignUp").value;
         const email = document.getElementById("signupEmail").value;
         const password = document.getElementById("signupPassword").value;
         const confirmPassword = document.getElementById("confirmPassword").value;
       
         // Validate password matching
         if (password !== confirmPassword) {
           showNotification("Passwords do not match!", "warning");
           return;
         }
       
         // Check if user already exists by email
         if (users.some(u => u.email === email)) {
           showNotification("User with this email already exists. Please log in.", "warning");
           return;
         }
       
         // Create new user object with additional attributes
         currentUser = { 
           firstName, 
           lastName, 
           email, 
           mobile, 
           password, 
           isLoggedIn: true, 
           lastActivity: new Date().toISOString(), 
           location: locations[Math.floor(Math.random() * locations.length)],
           notifications: [] // Initialize notifications array
         };
       
         // Add user to users array
         users.push(currentUser);
       
         // Notify about the new user sign-up
         showNotification("Sign Up successful!", "success");
         notifyOwner(`New user signed up: ${currentUser.firstName} ${currentUser.lastName} (${currentUser.email})`);
       
         // Persist data and update the UI
         saveData();
         updateHeaderProfile();
         updateMenuAccountDetails();
         showSection("homeSection");
       });
             // Contact form submission
             document.getElementById("contactForm")?.addEventListener("submit", function(e) {
               e.preventDefault();
               showNotification("Message was sent", "success");
               this.reset();
             });
         
              // Apply filters for Shop section
           function applyFilters() {
             const size = document.getElementById("filterSize").value;
             const color = document.getElementById("filterColor").value;
             const price = document.getElementById("filterPrice").value;
             activeFilters = {};
             if (size) activeFilters.size = size;
             if (color) activeFilters.color = color;
             if (price) activeFilters.price = price;
             let filteredProducts = [...products];
             if (activeFilters.size) {
               filteredProducts = filteredProducts.filter(p => p.size.split(",").map(s => s.trim().toLowerCase()).includes(activeFilters.size.toLowerCase()));
             }
             if (activeFilters.color) {
               filteredProducts = filteredProducts.filter(p => p.color.split(",").map(c => c.trim().toLowerCase()).includes(activeFilters.color.toLowerCase()));
             }
             if (activeFilters.price) {
               const [min, max] = activeFilters.price.split("-").map(Number);
               filteredProducts = filteredProducts.filter(p => p.price >= min && p.price <= max);
             }
             generateProducts("shopProductContainer", filteredProducts);
             displayActiveFilters();
           }
         
           // Display active filters for Shop section
           function displayActiveFilters() {
             const activeFilterDisplay = document.getElementById("activeFilterDisplay");
             let html = "";
             if (Object.keys(activeFilters).length > 0) {
               html += '<div class="filter-tags">';
               if (activeFilters.size) html += `<span class="badge bg-primary me-2" style="cursor: pointer;" onclick="removeFilter('size')">Size: ${activeFilters.size} <i class="bi bi-x"></i></span>`;
               if (activeFilters.color) html += `<span class="badge bg-primary me-2" style="cursor: pointer;" onclick="removeFilter('color')">Color: ${activeFilters.color} <i class="bi bi-x"></i></span>`;
               if (activeFilters.price) html += `<span class="badge bg-primary me-2" style="cursor: pointer;" onclick="removeFilter('price')">Price: ${activeFilters.price} <i class="bi bi-x"></i></span>`;
               html += '</div>';
             }
             activeFilterDisplay.innerHTML = html;
           }
         
           // Remove filter for Shop section
           function removeFilter(filterType) {
             if (filterType === 'size') document.getElementById('filterSize').value = '';
             else if (filterType === 'color') document.getElementById('filterColor').value = '';
             else if (filterType === 'price') document.getElementById('filterPrice').value = '';
             applyFilters();
           }
         
           // Clear all filters for Shop section
           function clearAllFilters() {
             document.getElementById('filterSize').value = '';
             document.getElementById('filterColor').value = '';
             document.getElementById('filterPrice').value = '';
             activeFilters = {};
             generateProducts("shopProductContainer", products);
             displayActiveFilters();
           }
               // Notify owner
               function notifyOwner(message) {
                 ownerNotifications.push({ message, date: new Date().toLocaleString() });
                 saveData();
               }
         
                // Update notifications
                function updateNotifications() {
                 const notificationsContent = document.getElementById("notificationsContent");
                 if (notifications.length === 0) {
                   notificationsContent.innerHTML = `
                     <div class="col-12 text-center py-5">
                       <i class="bi bi-bell" style="font-size: 3rem; color: #ddd;"></i>
                       <h5 class="mt-3">No Notifications</h5>
                       <p>You're all caught up!</p>
                     </div>
                   `;
                 } else {
                   notificationsContent.innerHTML = "";
                   notifications.slice().reverse().forEach((notif, index) => {
                     const card = `
                       <div class="col-md-6 col-lg-4">
                         <div class="card notification-card ${notif.type}">
                           <div class="card-header">
                             <i class="bi bi-bell-fill notification-icon"></i>
                             ${notif.date}
                           </div>
                           <div class="card-body">
                             <p class="notification-message">${notif.message}</p>
                            
                           </div>
                         </div>
                       </div>
                     `;
                     notificationsContent.innerHTML += card;
                   });
                 }
               }
                  // Clear all notifications
                  function clearNotifications() {
                   if (notifications.length === 0) {
                     showNotification("No notifications to clear.", "info");
                     return;
                   }
                   if (confirm("Are you sure you want to clear all notifications?")) {
                     notifications = [];
                     saveData();
                     updateNotifications();
                     showNotification("All notifications cleared.", "success");
                   }
                 }       
             // Function to print order card with QR code
             function printOrder(index) {
               const orderCards = document.querySelectorAll('.order-card');
               if (index < 0 || index >= orderCards.length) return;
               const orderCard = orderCards[index];
               
               document.body.classList.add('print-mode');
               orderCard.classList.add('print-selected');
               
               window.print();
               
               window.addEventListener('afterprint', function() {
                 document.body.classList.remove('print-mode');
                 orderCard.classList.remove('print-selected');
               }, { once: true });
             }
           
             // Function to download order card as PNG with QR code
             function downloadOrder(index) {
               const orderCards = document.querySelectorAll('.order-card');
               if (index < 0 || index >= orderCards.length) return;
               const orderCard = orderCards[index];
               
               html2canvas(orderCard).then(canvas => {
                 const link = document.createElement('a');
                 link.href = canvas.toDataURL('image/png');
                 link.download = `order_${index + 1}.png`;
                 link.click();
               }).catch(error => {
                 console.error('Error generating image:', error);
                 showNotification('Failed to generate image for download.', 'danger');
               });
             }
           // Initialize
           loadData();
           // Update header profile function 
         function updateHeaderProfile() {
          const headerProfile = document.getElementById('headerProfile');
          if (currentUser) {
            headerProfile.innerHTML = `<i class="bi bi-person-circle"></i> ${currentUser.firstName} ${currentUser.lastName}`;
          } else {
            headerProfile.innerHTML = `<i class="bi bi-person-circle"></i> Guest`;
          }
         }
         document.getElementById("sendMessageModal").addEventListener("hidden.bs.modal", function () {
           document.getElementById("messageText").value = "";
         });
               // Reset modal fields when shown
document.getElementById('buyModal').addEventListener('shown.bs.modal', function () {
  document.getElementById('couponCode').value = '';
  document.getElementById('couponMessage').textContent = '';
  const product = currentProductForPurchase;
  document.getElementById('modalTotalAmount').textContent = product.price.toFixed(2);
  document.getElementById('finalPrice').value = product.price.toFixed(2);
});

// Handle coupon application
document.getElementById('applyCouponButton').addEventListener('click', function () {
  const couponCode = document.getElementById('couponCode').value.trim();
  const product = currentProductForPurchase;
  let message = '';
  let totalAmount = product.price;

  if (couponCode && validCoupons.includes(couponCode)) {
    const discount = 0.20; // 20% discount
    totalAmount = product.price * (1 - discount);
    message = 'Coupon applied! 20% discount.';
  } else if (couponCode) {
    message = 'Invalid coupon code.';
  } else {
    message = '';
  }

  document.getElementById('couponMessage').textContent = message;
  document.getElementById('modalTotalAmount').textContent = totalAmount.toFixed(2);
  document.getElementById('finalPrice').value = totalAmount.toFixed(2);
});

          // Request Product form submission
          document.getElementById("requestProductForm")?.addEventListener("submit", function(e) {
           e.preventDefault();
       
           // Retrieve form values
           const category = document.getElementById("requestCategory").value;
           const clothType = document.getElementById("requestClothType").value;
           const size = document.getElementById("requestSize").value;
           const color = document.getElementById("requestColor").value;
           const message = document.getElementById("requestMessage").value;
       
           // Create a request object
           const request = {
             category,
             clothType,
             size,
             color,
             message,
             user: currentUser ? `${currentUser.firstName} ${currentUser.lastName} (${currentUser.email})` : "Guest",
             date: new Date().toLocaleString()
           };
       
           // Notify the owner
           notifyOwner(`New product request: Category - ${category}, Cloth Type - ${clothType}, Size - ${size}, Color - ${color}, Message - ${message || 'None'}, From - ${request.user}`);
       
           // Show notification to the user
           showNotification("Your product request has been sent to the owner.", "success");
       
           // Reset the form
           this.reset();
       
           // Return to home section
           showSection("homeSection");
         });
          // QR Code Generation and Download Functionality
function generateQRCode(content) {
  document.getElementById("qrcode").innerHTML = "";
  
  const qrcode = new QRCode(document.getElementById("qrcode"), {
    text: content,
    width: 200,
    height: 200,
    colorDark: "#000000",
    colorLight: "#ffffff",
    correctLevel: QRCode.CorrectLevel.H
  });

  document.getElementById("downloadQRCodeButton").onclick = function() {
    const canvas = document.querySelector("#qrcode canvas");
    const dataURL = canvas.toDataURL("image/png");
    const link = document.createElement("a");
    link.href = dataURL;
    link.download = "TEDPOLE_QRCode.png";
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  };
}

// Function to show QR code modal with specific content
function showQRCodeModal(content) {
  generateQRCode(content);
  const qrModal = new bootstrap.Modal(document.getElementById('qrCodeModal'));
  qrModal.show();
}

// Example usage for order QR code
function showOrderQRCode(orderId) {
  const orderDetailsUrl = `https://tedpole.in/order/${orderId}`;
  showQRCodeModal(orderDetailsUrl);
}

// Event listener for QR code display
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.show-qr-code').forEach(button => {
    button.addEventListener('click', function() {
      const orderId = this.getAttribute('data-order-id');
      showOrderQRCode(orderId);
    });
  });
});

// Reset message modal on hide
document.getElementById("sendMessageModal")?.addEventListener("hidden.bs.modal", function () {
  document.getElementById("messageText").value = "";
});

// Initialize QR code with default content and load data
window.onload = function() {
  generateQRCode("https://tedpole.in");
  loadData();
};
function filterShopByCategory(category) {
  // Hide the search bar container
  document.getElementById("searchBarContainer").style.display = "none";
  
  // Filter products by category
  const filteredProducts = products.filter(p => p.category === category);
  
  // Update the shop section with filtered products
  document.getElementById('shopResultsCount').textContent = `${filteredProducts.length} ${category} products`;
  
  // Call generateProducts with hideDiscounts flag set to true
  generateProducts("shopProductContainer", filteredProducts, true);
  
  // Show the shop section
  showSection('shopSection');
  
  // Scroll to the top of the shop section
  document.getElementById('shopSection').scrollIntoView({ behavior: 'smooth' });
}
function generateProducts(containerId, productList, showDiscount = true) {
  const container = document.getElementById(containerId);
  
  if (!container) return;

  // Update results count for non-featured containers
  if (containerId !== "featuredProductsContainer") {
    const countElement = document.getElementById(`${containerId.replace("Container", "")}ResultsCount`);
    if (countElement) {
      countElement.textContent = `${productList.length} products`;
    }
  }

  if (productList.length === 0) {
    container.innerHTML = `
      <div class="col-12 text-center py-5">
        <i class="bi bi-search" style="font-size: 3rem; color: #ccc;"></i>
        <h4 class="mt-3">No products found</h4>
        <p>Try adjusting your search</p>
      </div>
    `;
    return;
  }

  container.innerHTML = "";
  
  productList.forEach(product => {
    const discount = product.discount || 0;
    const originalPrice = discount > 0 ? (product.price / (1 - discount / 100)).toFixed(2) : product.price.toFixed(2);
    const ratingInfo = getProductRating(product.id);
    const isSoldOut = product.additionalDetails.toLowerCase().includes("sold out"); // Check for sold out
    if (containerId === "featuredProductsContainer") {
      const card = `
        <div class="col-6 col-md-4 col-lg-3 mb-4">
          <div class="card shadow-sm product-card" onclick="showProductDetails(${product.id})">
            <div style="position: relative;">
              <img src="${product.images && product.images.length ? product.images[0] : 'https://via.placeholder.com/400x300?text=' + encodeURIComponent(product.name)}" 
                   class="card-img-top" alt="${product.name}" style="height: 200px; object-fit: cover;">
              ${showDiscount && discount > 0 ? `<span class="badge bg-danger position-absolute top-0 start-0 m-2">${discount}% OFF</span>` : ''}
              ${isSoldOut ? `<span class="badge bg-dark position-absolute top-0 end-0 m-2">Sold Out</span>` : `
              `}
            </div>
            <div class="card-body">
              <h5 class="card-title">${product.name}</h5>
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <span class="fw-bold">₹${product.price.toFixed(2)}</span>
                  ${showDiscount && discount > 0 ? `<small class="text-decoration-line-through text-muted ms-1">₹${originalPrice}</small>` : ''}
                </div>
                ${ratingInfo ? `
                  <div class="d-flex align-items-center">
                    <i class="bi bi-star-fill text-warning me-1"></i>
                    <small>${ratingInfo.average}</small>
                  </div>
                ` : ''}
              </div>
            </div>
          </div>
        </div>
      `;
      container.innerHTML += card;
    } else {
      const card = `
        <div class="col-6 mb-4">
          <div class="card shadow-sm product-card" style="position: relative;" onclick="showProductDetails(${product.id})">
            <img src="${product.images && product.images.length ? product.images[0] : 'https://via.placeholder.com/400x300?text=' + encodeURIComponent(product.name)}" 
                 class="card-img-top" alt="${product.name}">
            ${showDiscount && discount > 0 ? `<span class="badge bg-danger position-absolute top-0 start-0 m-2">${discount}% OFF</span>` : ''}
            ${isSoldOut ? `<span class="badge bg-dark position-absolute top-0 end-0 m-2">Sold Out</span>` : `
            `}
            <div class="card-body">
              <h5 class="card-title">${product.name}</h5>
              <p class="card-text">${product.description}</p>
              <p class="card-text">
                <span class="fw-bold">₹${product.price.toFixed(2)}</span>
                ${showDiscount && discount > 0 ? `<small class="text-decoration-line-through text-muted ms-1">₹${originalPrice}</small>` : ''}
              </p>
              ${ratingInfo ? `
                <p class="card-text">
                  <i class="bi bi-star-fill text-warning"></i> 
                  ${ratingInfo.average} (${ratingInfo.count} reviews)
                </p>
              ` : ''}
            </div>
          </div>
        </div>
      `;
      container.innerHTML += card;
    }
  });
}
      </script>
         <!-- Bootstrap JS Bundle -->
         <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
         <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
         <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
         <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
         </body>
         <html> 
       
